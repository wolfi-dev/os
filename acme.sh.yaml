package:
  name: acme.sh
  version: "3.1.2"
  epoch: 0
  description: ACME Shell script, an acme client alternative to certbot
  copyright:
    - license: GPL-3.0-only
  dependencies:
    runtime:
      - curl
      - openssl
      - socat

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - curl
      - git

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/acmesh-official/acme.sh
      tag: ${{package.version}}
      expected-commit: 40290ad42a37aba57eb246e507c11944a52c0f68

  - runs: |
      install -dm755 "${{targets.destdir}}"/usr/share/acme.sh/deploy
      install -dm755 "${{targets.destdir}}"/usr/share/acme.sh/dnsapi
      install -dm755 "${{targets.destdir}}"/usr/share/acme.sh/notify
      install -dm755 "${{targets.destdir}}"/usr/bin

      install -m755 acme.sh "${{targets.destdir}}"/usr/share/acme.sh/
      install -m755 deploy/*.sh "${{targets.destdir}}"/usr/share/acme.sh/deploy/
      install -m755 dnsapi/*.sh "${{targets.destdir}}"/usr/share/acme.sh/dnsapi/
      install -m755 notify/*.sh "${{targets.destdir}}"/usr/share/acme.sh/notify/

      ln -s /usr/share/acme.sh/acme.sh "${{targets.destdir}}"/usr/bin/acme.sh

update:
  enabled: true
  github:
    identifier: acmesh-official/acme.sh
    strip-prefix: v

test:
  pipeline:
    - uses: test/tw/ver-check
      with:
        bins: acme.sh
    - uses: test/tw/help-check
      with:
        bins: acme.sh
