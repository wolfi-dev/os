package:
  name: aggregate
  version: "1.6.8"
  epoch: 0
  description: Optimise a list of route prefixes to help make nice short filters
  copyright:
    - license: ISC

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - coreutils
      - patch
  environment:
    CPPFLAGS: "-Wno-implicit-int" # Needed for checks in the configure script

var-transforms:
  - from: ${{package.version}}
    match: \.(\d+)$
    replace: -$1
    to: mangled-package-version

pipeline:
  - uses: git-checkout
    with:
      repository: https://salsa.debian.org/salvage-team/aggregate.git
      tag: debian/${{vars.mangled-package-version}}
      expected-commit: 74b302efd6b21d6d729e14aea5b76e25d89f1372

  - runs: "for patchfile in $(cat debian/patches/series); do\n  patch -p1 < debian/patches/$patchfile    \ndone    \n"

  - uses: autoconf/configure

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

test:
  pipeline:
    - runs: ""
    - runs: |
        set -euo pipefail
        aggregate --help

update:
  enabled: true
  git:
    strip-prefix: debian/
    tag-filter-contains: debian/
  version-transform:
    - match: -(\d)$
      replace: '.$1'
