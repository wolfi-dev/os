package:
  name: aws-lambda-base-image-python
  version: "git_20250401"
  epoch: 0
  description: Base image support for Python Lambda runtimes
  copyright:
    - license: Apache-2.0

# This comes from https://github.com/aws/aws-lambda-base-images
# 
# This repo is weird and gets periodic updates which are dumps of .tar.xz files
# that are ADDed in a Dockerfile to produce the official Python base image.
# 
# In reality, those layers provide all of Amazon Linux 2 and the Python runtime,
# and only really need to provide the Python bootstrap.py script, which depends on
# awslambdaric and aws-lambda-rie, to invoke the given handler.
#
# In practice, the bootstrap.py script hasn't seemed to change since 2018, and seems
# to support all Python versions, so it seems relatively safe to assume this will work
# indefinitely, or at least for a while.
# 
# This is meant to be called as an entrypoint like:
#   python /var/runtime/bootstrap.py [python_function.handler]
# with env vars:
# - LAMBDA_TASK_ROOT=/var/task
# - LAMBDA_RUNTIME_DIR=/var/runtime

environment:
  contents:
    packages:
      - busybox

pipeline:
  - runs: |
      mkdir -p ${{targets.destdir}}/var/runtime
      cp bootstrap.py ${{targets.destdir}}/var/runtime/bootstrap.py

data:
  - name: py-versions
    items:
      3.10: '310'
      3.11: '311'
      3.12: '312'
      3.13: '313'

subpackages:
  - range: py-versions
    name: aws-lambda-base-image-runtime-python${{range.key}}
    description: runtime version for python${{range.key}}
    dependencies:
      provider-priority: ${{range.value}}
      runtime:
        - py${{range.key}}-awslambdaric
    pipeline:
      - runs: |
          mkdir -p ${{targets.contextdir}}/var/runtime
          cat <<EOF > ${{targets.contextdir}}/var/runtime/runtime-release
          NAME=Python
          VERSION=${{range.key}}
          LOGGING=amzn-stdout-tlv
          EOF
    
update:
  enabled: false