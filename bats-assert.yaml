package:
  name: bats-assert
  version: 2.2.4
  epoch: 0
  description: Common assertions for Bats
  copyright:
    - license: CC0-1.0
  dependencies:
    runtime:
      - bats-support

environment:
  contents:
    packages:
      - busybox

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/bats-core/bats-assert
      tag: v${{package.version}}
      expected-commit: f1e9280eaae8f86cbe278a687e6ba755bc802c1a

  - runs: |
      for fn in "src/"*.bash; do
        install -Dm755 "load.bash" "${{targets.destdir}}/usr/lib/bats/${{package.name}}/load.bash"
        install -Dm0755 "$fn" "${{targets.destdir}}/usr/lib/bats/${{package.name}}/src/$(basename "$fn")"
      done

update:
  enabled: true
  git:
    strip-prefix: v

test:
  environment:
    contents:
      packages:
        - bats-core
  pipeline:
    - runs: |
        tee ./inline_test.bats <<'EOF'
        bats_load_library bats-support
        bats_load_library bats-assert

        @test "assert_one_bigger_than_zero" {
          assert [ 1 -gt 0 ]
        }

        @test "refute_zero_gt_one" {
          refute [ 0 -gt 1 ]
        }

        @test "equal" {
          assert_equal 0 0
        }
        EOF

        tee ./inline_fail_test.bats <<'EOF'
        bats_require_minimum_version 1.5.0

        @test 'fail to fail if library is not here' {
          run -127 assert_equal 0 0
        }
        EOF

        # Run the bats tests
        bats ./inline_test.bats
        bats ./inline_fail_test.bats
