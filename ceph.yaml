package:
  name: ceph
  version: 19.2.1
  epoch: 0
  description: Distributed object, block, and file storage
  copyright:
    - license: LGPL-2.1
  dependencies:
    runtime:
      - curl
      - libaio
      - libedit
      - libgcc
      - libstdc++
      - libudev
      - openssl
      - python-3.13
      - zlib

environment:
  contents:
    packages:
      - autoconf
      - automake
      - babeltrace-2
      - bash
      - bison
      - boost-dev
      - build-base
      - busybox
      - cmake
      - cryptsetup-dev
      - curl-dev
      - eudev
      - expat-dev
      - flex
      - gcc
      - gettext
      - glib-dev
      - gperf
      - graphviz
      - jaeger
      - keyutils-dev
      - krb5-dev
      - libaio-dev
      - libcap-ng-dev
      - libedit-dev
      - libnl3-dev
      - libtirpc-dev
      - libtool
      - lttng-ust-dev
      - lttng-ust-tools
      - lua5.3-dev
      - lz4-dev
      - make
      - nasm
      - ninja
      - nodejs
      - npm
      - oath-toolkit-dev
      - openldap-dev
      - openssl-dev
      - pkgconf
      - posix-libc-utils
      - py3.13-cython
      - py3.13-pyyaml
      - py3.13-setuptools
      - py3.13-sphinx
      - python-3.13-dev
      - snappy-dev
      - systemd-dev
      - thrift-dev
      - util-linux-dev
      - xfsprogs
      - yaml-cpp-dev
      - zlib-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/ceph/ceph.git
      tag: v${{package.version}}
      expected-commit: 58a7fab8be0a062d730ad7da874972fd3fba59fb
      recurse-submodules: true

  - uses: patch
    with:
      patches: ceph.patch boost-1.87.patch

  - uses: cmake/configure
    with:
      opts: |
        -DWITH_RADOSGW=OFF \
        -DWITH_FUSE=OFF \
        -DWITH_MANPAGE=OFF \
        -DWITH_RDMA=OFF \
        -DWITH_BABELTRACE=OFF \
        -DLUA_LIBRARIES=/usr/lib/lua5.3 \
        -DCYTHON_VERSION=3.0.11 \
        -DWITH_SYSTEM_BOOST=ON \
        -DWITH_SYSTEM_NPM=ON

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

update:
  enabled: true
  github:
    identifier: ceph/ceph
