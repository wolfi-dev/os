package:
  name: cifs-utils
  version: "7.4"
  epoch: 0
  description: CIFS filesystem user-space tools
  copyright:
    - license: GPL-3.0-or-later
  dependencies:
    runtime:
      - merged-sbin
      - merged-usrsbin
      - wolfi-baselayout

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - gcc-14-default
      - keyutils-dev
      - krb5-dev
      - libcap-dev
      - py3-docutils
      - samba-dev
      - talloc-dev

pipeline:
  - uses: fetch
    with:
      expected-sha512: 36fb64ed531e983752be243be488392ba52c3797ac638147a75998b8965448009e95d7ccda187c7d50d753b0ddb87a464a83044064b099d49fffe03a0b6ba739
      uri: https://ftp.samba.org/pub/linux-cifs/cifs-utils/cifs-utils-${{package.version}}.tar.bz2

  - uses: autoconf/configure
    with:
      opts: --sbindir=/usr/bin

  - uses: autoconf/make

  - runs: |
      make install DESTDIR="${{targets.destdir}}" ROOTSBINDIR=/usr/bin

  - uses: strip

subpackages:
  - name: cifs-utils-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - cifs-utils
        - merged-sbin
        - merged-usrsbin
        - wolfi-baselayout

  - name: "cifs-utils-doc"
    description: "cifs-utils documentation"
    pipeline:
      - uses: split/manpages
    test:
      pipeline:
        - uses: test/docs
    dependencies:
      runtime:
        - merged-sbin
        - merged-usrsbin
        - wolfi-baselayout

update:
  enabled: true
  release-monitor:
    identifier: 287

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        getcifsacl --version
        setcifsacl -v
        cifs.idmap --version
        cifs.upcall --version
        getcifsacl --help
        setcifsacl -h
        cifs.idmap --help
    - uses: test/tw/ldd-check
