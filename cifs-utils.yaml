package:
  name: cifs-utils
  version: "7.3"
  epoch: 40
  description: CIFS filesystem user-space tools
  copyright:
    - license: GPL-3.0-or-later
  dependencies:
    runtime:
      - merged-sbin
      - merged-usrsbin
      - wolfi-baselayout

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - keyutils-dev
      - krb5-dev
      - libcap-dev
      - py3-docutils
      - samba-dev
      - talloc-dev

pipeline:
  - uses: fetch
    with:
      expected-sha512: 7e341f5f5f53c3d533350cbd58983fddc428921ef8f8da6dea7b58884786b778fcc24ec23d0ebafc944ca54b9978213425fa6270e5c28934efb3383c0b66745a
      uri: https://ftp.samba.org/pub/linux-cifs/cifs-utils/cifs-utils-${{package.version}}.tar.bz2

  - uses: autoconf/configure
    with:
      opts: --sbindir=/usr/bin

  - uses: autoconf/make

  - runs: |
      make install DESTDIR="${{targets.destdir}}" ROOTSBINDIR=/usr/bin

  - uses: strip

subpackages:
  - name: cifs-utils-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - cifs-utils
        - merged-sbin
        - merged-usrsbin
        - wolfi-baselayout

  - name: "cifs-utils-doc"
    description: "cifs-utils documentation"
    pipeline:
      - uses: split/manpages
    test:
      pipeline:
        - uses: test/docs
    dependencies:
      runtime:
        - merged-sbin
        - merged-usrsbin
        - wolfi-baselayout

update:
  enabled: true
  release-monitor:
    identifier: 287

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        getcifsacl --version
        setcifsacl -v
        cifs.idmap --version
        cifs.upcall --version
        getcifsacl --help
        setcifsacl -h
        cifs.idmap --help
    - uses: test/tw/ldd-check
