package:
  name: cilium-cli
  version: "0.18.4"
  epoch: 2
  description: CLI to install, manage & troubleshoot Kubernetes clusters running Cilium
  copyright:
    - license: Apache-2.0

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/cilium/cilium-cli
      tag: v${{package.version}}
      expected-commit: 6e65fa094c051aee03959dc9a75e66213e9050c7

  - uses: go/build
    with:
      ldflags: -X github.com/cilium/cilium/cilium-cli/defaults.CLIVersion=v${{package.version}}
      output: cilium
      packages: ./cmd/cilium

update:
  enabled: true
  github:
    identifier: cilium/cilium-cli
    strip-prefix: v

test:
  pipeline:
    - runs: |
        cilium version | grep "${{package.version}}"
        cilium help | grep "^CLI to install, manage, & troubleshooting Cilium clusters running Kubernetes.$"
        cilium help bgp | grep "^Access to BGP control plane$"
        cilium help clustermesh | grep "^Multi Cluster Management$"
