#nolint:valid-pipeline-git-checkout-tag
package:
  name: cilium-startup-script
  description: "cilium-node-init script"
  epoch: 0
  version: 0.0_git20250720
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - bash
      - ca-certificates
      - util-linux
      - coreutils
      - coreutils-legacy
      - util-linux-misc

environment:
  contents:
    packages:
      - busybox

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/cilium/image-tools.git
      expected-commit: 49d7b282e76f941d6bf5abc4f125d14a1a7b2211
      branch: master

  - runs: |
      install -Dm755 ./images/startup-script/manage-startup-script.sh ${{targets.destdir}}/usr/bin/manage-startup-script.sh

      mkdir -p ${{targets.destdir}}/var
      ln -sf /run ${{targets.destdir}}/var/run

test:
  pipeline:
    - runs: |
        stat /usr/bin/manage-startup-script.sh

update:
  enabled: true
  git: {}
  schedule:
    period: monthly
    reason: |
      cilium/image-tools do not have tags or releases.
      Monthly checks ensure we don't miss updates while avoiding excessive build triggers.
