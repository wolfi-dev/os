package:
  name: cowsay
  version: 3.04
  epoch: 2
  description: Configurable talking cow (and a few other creatures)
  copyright:
    - license: GPL-3.0
  dependencies:
    runtime:
      - perl

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - perl

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/tnalpgge/rank-amateur-cowsay
      expected-commit: 99058032db7cafbc507a3fbe8cae6be2d9f65ee3
      tag: cowsay-${{package.version}}

  - runs: |
      # The cowsay script has an install prefix but then hardcodes it in the final perl, so if we
      # set it to ${{targets.destdir}}/usr, that also ends up in the final perl script.
      # Use sed to hardcode that part to /usr instead.
      sed -i 's|%PREFIX%|/usr|g' cowsay
      mkdir -p ${{targets.destdir}}/usr
      ./install.sh ${{targets.destdir}}/usr

  - uses: strip

update:
  enabled: true
  ignore-regex-patterns:
    - rel-
  github:
    use-tag: true
    identifier: tnalpgge/rank-amateur-cowsay
    strip-prefix: cowsay-
    tag-filter: cowsay-

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        cowsay --version
        cowthink --version
        cowsay --help
        cowthink --help
