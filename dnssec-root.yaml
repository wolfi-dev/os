package:
  name: dnssec-root
  version: "20190225"
  epoch: 4
  description: The DNSSEC root key(s)
  copyright:
    - license: CC-PDDC

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - gpg
      - openssl
      - python3

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/iana-org/get-trust-anchor
      branch: master
      expected-commit: 179765e80ebde71594b0e14cc6d6a506d911699a

  - runs: |
      python3 get_trust_anchor.py
      sort -k 6 ksk-as-dnskey.txt* > trusted-key.key

      # abump on alpine updates the version?  https://wiki.alpinelinux.org/wiki/Include:Abump
      # abump dnssec-root-$(date "+%Y%m%d")

      mkdir -p ${{targets.destdir}}/usr/share/dnssec-root
      install -Dm644 trusted-key.key ${{targets.destdir}}/usr/share/dnssec-root/trusted-key.key

update:
  enabled: false
  exclude-reason: "no releases or tags, commit sha is used, not auto updatable"
  manual: true
  github:
    identifier: iana-org/get-trust-anchor
