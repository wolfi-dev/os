package:
  name: docker-library
  version: 0_git20250822
  epoch: 0
  description: Docker library utility scripts for official Docker images
  copyright:
    - license: Apache-2.0

var-transforms:
  - from: ${{package.version}}
    match: '^\d+_git(\d+)$'
    replace: '$1'
    to: timestamp

environment:
  contents:
    packages:
      - busybox

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/docker-library/docker
      branch: master
      expected-commit: bce646b7ffd6d126d920a3e06dd59d9192be8d9c

  - runs: |
      mkdir -p "${{targets.destdir}}"/home/docker-library
      find . -maxdepth 1 -mindepth 1 ! -name "melange-out" -exec cp -r {} "${{targets.destdir}}"/home/docker-library/ \;
      mkdir -p "${{targets.destdir}}"/usr/share/docker-library
      find . -maxdepth 1 -mindepth 1 ! -name "melange-out" -exec cp -r {} "${{targets.destdir}}"/usr/share/docker-library/ \;
      find "${{targets.destdir}}" -name "*.sh" -exec chmod +x {} \;

test:
  pipeline:
    - runs: |
        test -f /home/docker-library/docker-entrypoint.sh
        test -f /home/docker-library/dockerd-entrypoint.sh
        test -f /usr/share/docker-library/docker-entrypoint.sh
        test -f /usr/share/docker-library/dockerd-entrypoint.sh
        test -x /home/docker-library/docker-entrypoint.sh
        test -x /usr/share/docker-library/dockerd-entrypoint.sh

update:
  enabled: true
  git: {}
  schedule:
    period: daily
    reason: Upstream does not maintain tags or releases. Daily updates ensure Docker entrypoint scripts stay current.
