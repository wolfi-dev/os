# Generated from https://git.alpinelinux.org/aports/plain/main/elfutils/APKBUILD
package:
  name: elfutils
  version: "0.194"
  epoch: 0
  description: Utilities and DSOs to handle ELF files and DWARF data
  copyright:
    - license: GPL-3.0-or-later AND ( GPL-2.0-or-later OR LGPL-3.0-or-later )

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bison
      - build-base
      - busybox
      - bzip2-dev
      - ca-certificates-bundle
      - curl-dev
      - flex-dev
      - json-c-dev
      - libarchive-dev
      - libmicrohttpd-dev
      - libtool
      - linux-headers
      - openssl-dev
      - sqlite-dev
      - xz-dev
      - zlib-dev
      - zstd-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: 09e2ff033d39baa8b388a2d7fbc5390bfde99ae3b7c67c7daaf7433fbcf0f01e
      uri: https://sourceware.org/elfutils/ftp/${{package.version}}/elfutils-${{package.version}}.tar.bz2

  - runs: |
      CFLAGS="$CFLAGS -Wno-error -Wno-null-dereference" \
      ./configure \
        --build=$CBUILD \
        --host=$CHOST \
        --prefix=/usr \
        --sysconfdir=/etc \
        --mandir=/usr/share/man \
        --localstatedir=/var \
        --disable-werror \
        --program-prefix=eu- \
        --enable-deterministic-archives \
        --disable-nls \
        --enable-libdebuginfod \
        --enable-debuginfod \
        --with-zstd

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: debuginfod
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin/
          mv "${{targets.destdir}}"/usr/bin/debuginfod* "${{targets.subpkgdir}}"/usr/bin
    dependencies:
      runtime:
        - libdebuginfod=${{package.full-version}}
    # test added by a robot (binary)
    test:
      pipeline:
        - runs: |
            stat /usr/bin/debuginfod
            stat /usr/bin/debuginfod-find

  - name: libdebuginfod
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/
          mv "${{targets.destdir}}"/usr/lib/libdebuginfod.so.* "${{targets.subpkgdir}}"/usr/lib/
    test:
      pipeline:
        - uses: test/tw/ldd-check

  - name: libdebuginfod-dev
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/include/elfutils "${{targets.subpkgdir}}"/usr/lib/pkgconfig
          mv "${{targets.destdir}}"/usr/include/elfutils/debuginfod.h "${{targets.subpkgdir}}"/usr/include/elfutils
          mv "${{targets.destdir}}"/usr/lib/libdebuginfod*.so "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/pkgconfig/libdebuginfod.pc "${{targets.subpkgdir}}"/usr/lib/pkgconfig
    dependencies:
      runtime:
        - libdebuginfod=${{package.full-version}}
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: libelf
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib/
          mv "${{targets.destdir}}"/usr/lib/*.so.* "${{targets.subpkgdir}}"/usr/lib/
          mv "${{targets.destdir}}"/usr/lib/*-*.so "${{targets.subpkgdir}}"/usr/lib/
    test:
      pipeline:
        - uses: test/tw/ldd-check

  - name: libelf-static
    pipeline:
      - uses: split/static
    description: elfutils static

  - name: elfutils-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - elfutils
    description: elfutils dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: elfutils-doc
    pipeline:
      - uses: split/manpages
    description: elfutils manpages
    test:
      pipeline:
        - uses: test/docs

update:
  enabled: true
  release-monitor:
    identifier: 5679

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        eu-addr2line --version
        eu-ar --version
        eu-elfclassify --version
        eu-elfcmp --version
        eu-elfcompress --version
        eu-elflint --version
        eu-findtextrel --version
        eu-make-debug-archive --version
        eu-nm --version
        eu-objdump --version
        eu-ranlib --version
        eu-readelf --version
        eu-size --version
        eu-srcfiles --version
        eu-stack --version
        eu-strings --version
        eu-strip --version
        eu-unstrip --version
        eu-addr2line --help
        eu-ar --help
        eu-elfclassify --help
        eu-elfcmp --help
        eu-elfcompress --help
        eu-elflint --help
        eu-findtextrel --help
        eu-make-debug-archive --help
        eu-nm --help
        eu-objdump --help
        eu-ranlib --help
        eu-readelf --help
        eu-size --help
        eu-srcfiles --help
        eu-stack --help
        eu-strings --help
        eu-strip --help
        eu-unstrip --help
    - uses: test/no-docs
