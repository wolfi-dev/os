package:
  name: evolution-data-server
  version: 3.56.2
  epoch: 0
  description: Centralized access to appointments and contacts
  copyright:
    - license: LGPL-2.0-or-later

environment:
  contents:
    packages:
      - busybox
      - build-base
      - glib-dev
      - krb5-dev
      - gettext-dev
      - openldap-dev
      - libnspr-dev
      - libnss-dev
      - gperf
      - libxml2-dev
      - libsoup-dev
      - icu-dev
      - gtk-3-dev
      - gtk-4-dev
      - json-glib-dev
      - gnome-online-accounts-dev
      - db-dev
      - libgweather-dev
      - libcanberra-dev
      - libsecret-dev
      - libical-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.gnome.org/GNOME/evolution-data-server.git
      tag: ${{package.version}}
      expected-commit: 9330886fe4c5685bd18d1979bd5c60cb9c3fcc6d

  - uses: cmake/configure
    with:
      opts: |
        -DWITH_NSPR_INCLUDES=/usr/include/nspr \
        -DWITH_NSS_INCLUDES=/usr/include/nss \
        -DENABLE_OAUTH2_WEBKITGTK=OFF \
        -DENABLE_OAUTH2_WEBKITGTK4=OFF # we need webkitgtk{,4} packaged

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: ${{package.name}}-dev
    description: ${{package.name}} development libraries and headers
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check
