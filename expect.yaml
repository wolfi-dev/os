# Partly generated from https://git.alpinelinux.org/aports/plain/main/expect/APKBUILD
package:
  name: expect
  version: 5.45.4
  epoch: 0
  description: A tool for automating interactive applications
  copyright:
    - license: NIST-PD
  dependencies:
    runtime:
      - tcl
      - libstdc++

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - libstdc++
      - tcl-dev
      - wget

pipeline:
  - uses: fetch
    with:
      expected-sha256: 49a7da83b0bdd9f46d04a04deec19c7767bb9a323e40c4781f89caf760b92c34
      uri: https://downloads.sourceforge.net/project/expect/Expect/${{package.version}}/expect${{package.version}}.tar.gz

  - uses: patch
    with:
      patches: |
        07-file-handle.patch
        09-unsafe-traps.patch
        10-manpage.patch
        12-fdout.patch
        22-segfault-with-stubs.patch
        24-format.patch

  - uses: autoconf/configure
    with:
      opts: |
        --with-tcl=/usr/lib \
        --with-tclinclude=/usr/include \
        --disable-rpath

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

update:
  enabled: true
  release-monitor:
    identifier: 771

test:
  pipeline:
    - name: Validate expect installation
      runs: |
        expect -v
