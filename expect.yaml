# Partly generated from https://git.alpinelinux.org/aports/plain/main/expect/APKBUILD
package:
  name: expect
  version: 5.45.4
  epoch: 0
  description: A tool for automating interactive applications
  copyright:
    - license: NIST-PD
  dependencies:
    runtime:
      - tcl
      - libstdc++
environment:
  contents:
    repositories:
      - https://packages.wolfi.dev/os
    keyring:
      - https://packages.wolfi.dev/os/wolfi-signing.rsa.pub
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - tcl-dev
      - wget
      - libstdc++
pipeline:
  - uses: fetch
    with:
      expected-sha256: 49a7da83b0bdd9f46d04a04deec19c7767bb9a323e40c4781f89caf760b92c34
      uri: https://downloads.sourceforge.net/project/expect/Expect/${{package.version}}/expect${{package.version}}.tar.gz
  - runs: |
      wget -r -np -A "*.patch" -nH -e robots=off --cut-dirs=4 https://git.alpinelinux.org/aports/plain/main/expect/
  - uses: patch
    with:
      patches: |
        07-file-handle.patch
        09-unsafe-traps.patch
        10-manpage.patch
        12-fdout.patch
        22-segfault-with-stubs.patch
        24-format.patch
  - uses: autoconf/configure
    with:
        opts: |
          --with-tcl=/usr/lib \
          --with-tclinclude=/usr/include \
          --disable-rpath
  - uses: autoconf/make
  - runs: |
      make test
  - uses: autoconf/make-install
  - uses: strip
update:
  enabled: true
  release-monitor:
    identifier: 771
