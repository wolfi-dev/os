package:
  name: flannel
  version: "0.26.5"
  epoch: 3
  description: flannel is a network fabric for containers, designed for Kubernetes
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - go

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/flannel-io/flannel
      tag: v${{package.version}}
      expected-commit: 0d1f8e28f5a6697629c7b39627b342ac48f09862

  - uses: go/bump
    with:
      deps: |-
        golang.org/x/oauth2@v0.27.0
        golang.org/x/crypto@v0.35.0
        golang.org/x/net@v0.36.0

  # Build with CGO_ENABLED=1 to include the UDP backend
  - runs: |
      CGO_ENABLED=0
      if [ "$(go env GOARCH)" = "amd64" ]; then
        CGO_ENABLED=1
      fi
      CGO_ENABLED=$(CGO_ENABLED) go build -o "${{targets.destdir}}"/usr/bin/flanneld \
        -ldflags '-extldflags "-static" -X github.com/flannel-io/flannel/pkg/version.version=${{package.version}}'

update:
  enabled: true
  github:
    identifier: flannel-io/flannel
    strip-prefix: v

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        flanneld --version
        flanneld --help
