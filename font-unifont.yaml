package:
  name: font-unifont
  version: 16.0.03
  epoch: 0
  description: GNU Unifont glyphs
  copyright:
    - license: GPL-2.0-or-later

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle

pipeline:
  - uses: fetch
    with:
      expected-sha256: 2eee0454e7e570ac22b637f9f622a9c06cfc56e61931069d0d667ce5c2ae189e
      uri: https://ftp.gnu.org/gnu/unifont/unifont-${{package.version}}/unifont-${{package.version}}.tar.gz

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

  - runs: |
      cd ${{targets.contextdir}}/usr/share/unifont
      rm -r html ChangeLog* INSTALL* NEWS* README* ./*.pdf

subpackages:
  - name: ${{package.name}}-tools
    description: Unifonts tools
    dependencies:
      runtime:
        - bdftopcf
    pipeline:
      - runs: | 
          mkdir -p ${{targets.contextdir}}/usr/bin
          mv ${{targets.destdir}}/usr/bin/* ${{targets.contextdir}}/usr/bin
    test:
      environment:
        contents:
          packages:
            - ${{package.name}}-misc
            - file
      pipeline:
        - runs: |
            hex2bdf < /usr/share/unifont/unifont.hex > test.bdf
            bdftopcf test.bdf > test.pcf
            file test.pcf | grep "X11 Portable Compiled Font data"
            unibdf2hex < test.bdf > test.hex
            file test.hex | grep "ASCII text"

  - name: ${{package.name}}-doc
    description: Unifont Documentation
    pipeline:
      - runs: | 
          mkdir -p ${{targets.contextdir}}/usr/share/unifont
          mv ${{targets.destdir}}/usr/share/unifont/*.info.* ${{targets.contextdir}}/usr/share/unifont
    test:
      pipeline:
        - runs: |
            stat /usr/share/unifont/unifont.info.gz

  - name: ${{package.name}}-misc
    description: Unifont hex/bmp files
    pipeline:
      - runs: | 
          mkdir -p ${{targets.contextdir}}/usr/share/unifont
          mv ${{targets.destdir}}/usr/share/unifont/* ${{targets.contextdir}}/usr/share/unifont
    test:
      pipeline:
        - runs: |
            stat /usr/share/unifont/unifont.hex
            stat /usr/share/unifont/unifont.bmp.gz

update:
  enabled: false
  exclude-reason: No releases or tags

test:
  environment:
    contents:
      packages:
        - fontconfig
  pipeline:
    - uses: test/fonts
    - runs: | 
        fc-list | grep -i unifont