package:
  name: fontforge
  version: "20230101"
  epoch: 0
  description: Free (libre) font editor
  copyright:
    - license: GPL-3.0-or-later

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - cmake
      - freetype-dev
      - giflib-dev
      - gnu-libiconv-dev
      - gtk-3-dev
      - libspiro-dev
      - libxml2-dev
      - pango-dev
      - potrace
      - py3-setuptools
      - python3-dev
      - readline-dev
      - samurai
      - tiff-dev
      - woff2-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/fontforge/fontforge
      expected-commit: a1dad3e81da03d5d5f3c4c1c1b9b5ca5ebcfcecf
      tag: ${{package.version}}

  - runs: |
      mkdir -p build
      export CFLAGS="$CFLAGS -flto=auto -I/usr/include/gnu-libiconv"
      export CXXFLAGS="$CXXFLAGS -flto=auto -I/usr/include/gnu-libiconv"
      cd build
      cmake \
      	-DCMAKE_BUILD_TYPE=Release \
      	-DCMAKE_INSTALL_PREFIX=/usr \
      	-DENABLE_MAINTAINER_TOOLS=TRUE \
      	-DENABLE_FONTFORGE_EXTRAS=TRUE \
        -DENABLE_GUI=OFF \
        -DENABLE_LIBSPIRO=ON \
        -DENABLE_LIBREADLINE=ON \
        -DENABLE_WOFF2=ON \
        -DENABLE_DOCS=OFF \
      	-DUNIX=TRUE \
      	..
      make

      make DESTDIR="${{targets.destdir}}" install

  - uses: strip

subpackages:
  - name: fontforge-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - fontforge
    description: fontforge dev

  - name: fontforge-doc
    pipeline:
      - uses: split/manpages
    description: fontforge manpages

  - name: py3-fontforge
    pipeline:
      - runs: |
          mv "${{targets.destdir}}"/usr/lib/python3.* "${{targets.subpkgdir}}"/usr/lib/python3.*
          mv "${{targets.destdir}}"/usr/share/fontforge/python "${{targets.subpkgdir}}"/usr/share/fontforge/python
    description: Python 3 bindings for fontforge

update:
  enabled: true
  github:
    identifier: fontforge/fontforge
