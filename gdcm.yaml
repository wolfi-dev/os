package:
  name: gdcm
  version: "3.2.2"
  epoch: 0
  description: "Grassroots DICOM Gdcm, Cross-platform DICOM implementation library for C++"
  copyright:
    - license: BSD-3-Clause

environment:
  contents:
    packages:
      - build-base
      - busybox

var-transforms:
  - from: ${{package.version}}
    match: ^(\d+\.\d+)\.\d+$
    replace: "$1"
    to: major-minor-version

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/malaterre/GDCM
      tag: v${{package.version}}
      expected-commit: 2d66f14563fb5e32fd538744f6c9fe532ddd3526

  - uses: cmake/configure
    with:
      opts: |
        -DCMAKE_BUILD_TYPE=Release \
        -DGDCM_BUILD_TESTING=OFF \
        -DGDCM_BUILD_EXAMPLES=OFF

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: ${{package.name}}-static
    description: ohif viewer static files
    pipeline:
      - uses: split/static

  - name: ${{package.name}}-dev
    description: Development files for ohif-viewer
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - ${{package.name}}
        - ${{package.name}}-static
    test:
      pipeline:
        - uses: test/tw/ldd-check

test:
  environment:
    contents:
      packages:
        - ${{package.name}}-dev
        - ${{package.name}}-static
        - gcc
  pipeline:
    - uses: test/tw/ldd-check
    - name: Test GDCM library functionality
      runs: |
        cat > test_gdcm.cpp << 'EOF'
        #include <gdcmVersion.h>
        #include <gdcmReader.h>
        #include <iostream>

        int main() {
            std::cout << "GDCM Version: " << gdcm::Version::GetVersion() << std::endl;
            gdcm::Reader reader;
            std::cout << "GDCM library test passed!" << std::endl;
            return 0;
        }
        EOF

        g++ -I/usr/include/gdcm-${{vars.major-minor-version}} -o test_gdcm test_gdcm.cpp -lgdcmDSED -lgdcmMSFF -lgdcmCommon -lgdcmDICT -lgdcmIOD -lgdcmzlib
        ./test_gdcm

update:
  enabled: true
  git:
    strip-prefix: v
    tag-filter-contains: v
