package:
  name: geckodriver
  version: "0.36.0"
  epoch: 2
  description: A tool for exploring each layer in a docker image
  copyright:
    - license: MPL-2.0

environment:
  contents:
    packages:
      - build-base

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/mozilla/geckodriver
      tag: v${{package.version}}
      expected-commit: d139fa08c9c6f954bbd397dc29f646efc8aca023

  - uses: rust/cargobump
    with:
      cargoroot: .

  - name: Configure and Build
    uses: cargo/build
    with:
      modroot: .
      output: geckodriver

  - uses: strip

update:
  enabled: true
  github:
    identifier: mozilla/geckodriver
    strip-prefix: v

test:
  environment:
    contents:
      packages:
        - py3-pip
        - python3
        - firefox
  pipeline:
    # AUTOGENERATED
    - name: Run basic geckodriver tests
      runs: |
        geckodriver --version
        geckodriver --help
    - name: Run Selenium test
      runs: |
        test -x /usr/bin/firefox
        pip3 install selenium

        python3 ./test-geckodriver.py
