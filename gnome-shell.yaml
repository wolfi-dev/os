package:
  name: gnome-shell
  version: "48.2"
  epoch: 0
  description: Core user interface for GNOME
  copyright:
    - license: GPL-2.0-or-later
  options:
    no-depends: true
  dependencies:
    runtime:
      - NetworkManager
      - evolution-data-server
      - gjs
      - gnome-autoar
      - libpulse-mainloop-glib
      - mutter
      - glib-gir # required by gjs bindings
      - accountsservice # required by gjs bindings
      - gdm # required by gjs bindings
      - geoclue # required by gjs bindings
      - ibus # required by gjs bindings
      # - gobject-introspection-dev # required by gjs bindings for gnome-extensions-app

environment:
  contents:
    packages:
      - NetworkManager-dev
      - build-base
      - busybox
      - evolution-data-server-dev
      - gcr-dev
      - gjs-dev
      - glib-gir
      - gnome-autoar-dev
      - gtk-4-dev
      - jasmine-gjs
      - mutter-dev
      - pkgconf-dev
      - pulseaudio-dev
      - py3-docutils
      - python3
      - sassc
      - systemd-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.gnome.org/GNOME/gnome-shell.git
      tag: ${{package.version}}
      expected-commit: 8c88f917db0f1f0d80fa55206c863d3746fa18d0

  - uses: git-checkout
    with:
      repository: https://gitlab.gnome.org/GNOME/libgnome-volume-control.git
      expected-commit: 5f9768a2eac29c1ed56f1fbb449a77a3523683b6
      branch: master
      destination: subprojects/gvc

  - uses: meson/configure
    with:
      opts: |
        -Ddefault_library=shared

  - uses: meson/compile

  - uses: meson/install

  - uses: strip

update:
  enabled: true
  git: {}

subpackages:
  - name: ${{package.name}}-dev
    description: ${{package.name}} development libraries and headers
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

test:
  pipeline:
    - uses: test/tw/ldd-check
    - runs: |
        gnome-shell --help
        gnome-shell --version
