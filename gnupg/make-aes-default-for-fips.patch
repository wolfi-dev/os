# When by any chance we're in FIPS mode, use AES256 instead of 3DES by default.
From: ≈Åukasz 'sil2100' Zemczak (lukasz.zemczak@chainguard.dev)
Date: 2025-07-25 15:03:08 +0200
Subject: disable 3DES

gnupg: add patch to not use 3DES in FIPS mode

--- gnupg-2.4.8.orig/g10/main.h
+++ gnupg-2.4.8/g10/main.h
@@ -38,7 +38,7 @@
 #elif GPG_USE_CAST5
 # define DEFAULT_CIPHER_ALGO     CIPHER_ALGO_CAST5
 #else
-# define DEFAULT_CIPHER_ALGO     CIPHER_ALGO_3DES
+# define DEFAULT_CIPHER_ALGO     (gcry_fips_mode_active() ? CIPHER_ALGO_AES256 : CIPHER_ALGO_3DES)
 #endif
 
 #define DEFAULT_DIGEST_ALGO     ((GNUPG)? DIGEST_ALGO_SHA512:DIGEST_ALGO_SHA1)
--- gnupg-2.4.8.orig/g10/pkclist.c
+++ gnupg-2.4.8/g10/pkclist.c
@@ -1523,7 +1523,9 @@ select_algo_from_prefs(PK_LIST pk_list,
 	     thing that was dropped from 4880 but is still relevant to
 	     GPG's 1991 support.  All this doesn't mean IDEA is
 	     actually available, of course. */
-          if (opt.flags.allow_old_cipher_algos)
+	  if (gcry_fips_mode_active ())
+	    implicit = CIPHER_ALGO_AES256;
+	  else if (opt.flags.allow_old_cipher_algos)
             implicit = CIPHER_ALGO_3DES;
           else
             implicit = CIPHER_ALGO_AES;
