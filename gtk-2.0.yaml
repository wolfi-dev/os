package:
  name: gtk-2.0
  version: "2.24.33"
  epoch: 8
  description: The GTK+ Toolkit (v2)
  copyright:
    - license: LGPL-2.0-or-later
  dependencies:
    runtime:
      - cmd:gtk-update-icon-cache

environment:
  contents:
    packages:
      - at-spi2-core-dev
      - autoconf
      - automake<1.17
      - build-base
      - busybox
      - ca-certificates-bundle
      - cairo-dev
      - cups-dev
      - expat-dev
      - fribidi-dev
      - gdk-pixbuf-dev
      - gettext-dev
      - glib-dev
      - glib-gir
      - gobject-introspection-dev
      - gtk-doc
      - harfbuzz-dev
      - hicolor-icon-theme
      - intltool
      - libatk-1.0
      - libatk-bridge-2.0
      - libice-dev
      - libjpeg-turbo-dev
      - libtool<2.5
      - libx11-dev
      - libxcomposite-dev
      - libxcursor-dev
      - libxdamage-dev
      - libxext-dev
      - libxfixes-dev
      - libxft-dev
      - libxi-dev
      - libxrandr-dev
      - pango-dev
      - pkgconf-dev
      - shared-mime-info
      - tiff-dev
      - zlib-dev
  environment:
    CFLAGS: -Wno-deprecated-declarations -Wno-unused-but-set-variable -Wno-incompatible-pointer-types -Wno-implicit-int

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.gnome.org/GNOME/gtk
      tag: ${{package.version}}
      expected-commit: 68631945733158f164427db84f01301d7e875763

  - runs: NOCONFIGURE=1 ./autogen.sh

  - uses: autoconf/configure
    with:
      opts: |
        --enable-gtk-doc

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: gtk-2.0-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - at-spi2-core-dev
        - cairo-dev
        - intltool
        - libxdamage-dev
        - pango-dev
        - shared-mime-info
    description: gtk+2.0 dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: gtk-2.0-doc
    pipeline:
      - uses: split/manpages
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share
          mv "${{targets.destdir}}"/usr/share/gtk-doc "${{targets.subpkgdir}}"/usr/share/
    description: gtk+2.0 manpages
    test:
      pipeline:
        - uses: test/docs

  - name: gtk-2.0-lang
    pipeline:
      - uses: split/locales
    description: gtk+2.0 locales

  - name: gtk-2.0-update-icon-cache
    description: GTK 2 gtk-update-icon-cache utility
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/bin
          mv "${{targets.destdir}}"/usr/bin/gtk-update-icon-cache "${{targets.subpkgdir}}"/usr/bin/
    test:
      pipeline:
        - runs: gtk-update-icon-cache --help
        - uses: test/tw/ldd-check

update:
  enabled: true
  release-monitor:
    identifier: 311540

test:
  pipeline:
    - uses: test/tw/ldd-check
