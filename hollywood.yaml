package:
  name: hollywood
  version: "1.25"
  epoch: 0
  description: "fill your console with Hollywood melodrama technobabble"
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - atop
      - bat
      - byobu
      - ccze
      - cmatrix
      - coreutils
      - figlet
      - jp2a
      - man-db
      - pv
      - tmux

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - wolfi-base

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dustinkirkland/hollywood
      expected-commit: 4bfa29772a6e2f1e4aecbd3e26fde7dc69cce6eb
      tag: ${{package.version}}

  - runs: |
      mkdir -p "${{targets.destdir}}"/usr/bin
      mkdir -p "${{targets.destdir}}"/usr/lib
      mkdir -p "${{targets.destdir}}"/usr/share/man/man1
      mkdir -p "${{targets.destdir}}"/usr/share

      install -m 755 bin/hollywood "${{targets.destdir}}"/usr/bin/
      cp -a lib/hollywood "${{targets.destdir}}"/usr/lib/
      install -m 644 share/man/man1/hollywood.1 "${{targets.destdir}}"/usr/share/man/man1/
      cp -a share/hollywood "${{targets.destdir}}"/usr/share/

update:
  enabled: true
  github:
    identifier: dustinkirkland/hollywood
    use-tag: true

test:
  environment:
    contents:
      packages:
        - bash
        - byobu
        - tmux
  pipeline:
    - uses: test/tw/ldd-check
    - runs: |
        set -euo pipefail
        # Verify hollywood binary exists
        stat /usr/bin/hollywood
        # Check script syntax (bash -n checks for syntax errors without executing)
        bash -n /usr/bin/hollywood
        # Verify all widget lib scripts exist and have valid syntax
        stat /usr/lib/hollywood/apg
        stat /usr/lib/hollywood/atop
        stat /usr/lib/hollywood/bat
        stat /usr/lib/hollywood/bmon
        stat /usr/lib/hollywood/cmatrix
        stat /usr/lib/hollywood/code
        stat /usr/lib/hollywood/errno
        stat /usr/lib/hollywood/figlet
        stat /usr/lib/hollywood/hexdump
        stat /usr/lib/hollywood/htop
        stat /usr/lib/hollywood/jp2a
        stat /usr/lib/hollywood/logs
        stat /usr/lib/hollywood/man
        stat /usr/lib/hollywood/map
        stat /usr/lib/hollywood/mplayer
        stat /usr/lib/hollywood/pv
        stat /usr/lib/hollywood/speedometer
        stat /usr/lib/hollywood/sshart
        stat /usr/lib/hollywood/stat
        stat /usr/lib/hollywood/tree
        # Verify share directory
        stat /usr/share/hollywood

subpackages:
  - name: hollywood-doc
    description: hollywood documentation
    pipeline:
      - uses: split/manpages
    test:
      pipeline:
        - uses: test/tw/docs
