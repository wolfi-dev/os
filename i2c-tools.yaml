package:
  name: i2c-tools
  version: "4.4"
  epoch: 2
  description: Tools for monitoring I2C devices
  copyright:
    - license: GPL-2.0-or-later AND LGPL-2.1-or-later

vars:
  py-version: 3.13

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - linux-headers
      - openssf-compiler-options
      - py${{vars.py-version}}-build-base-dev
      - python-${{vars.py-version}}-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: af01d0fbe78e109a2db7137c7e9bfda3f3fb236c3177744c0f2695d1056cde71
      uri: https://fossies.org/linux/misc/i2c-tools-${{package.version}}.tar.gz

  - runs: |
      make DESTDIR="${{targets.destdir}}"
      builddir="$(pwd)"
      cd "$builddir"/py-smbus
      CFLAGS="$CFLAGS -I$builddir/include" python${{vars.py-version}} setup.py build
      cd $builddir
      make DESTDIR="${{targets.destdir}}" install
      cd "$builddir"/py-smbus
      python${{vars.py-version}} setup.py install --skip-build --root="${{targets.destdir}}"

  - uses: strip

subpackages:
  - name: i2c-tools-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - i2c-tools
    description: i2c-tools dev

  - name: i2c-tools-doc
    pipeline:
      - uses: split/manpages
    description: i2c-tools manpages

  - name: py${{vars.py-version}}-smbus
    pipeline:
      - runs: |
          install -d "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/python3* "${{targets.subpkgdir}}"/usr/lib
    description: i2c-tools python bindings
    dependencies:
      runtime:
        - i2c-tools
    options:
      no-depends: true

update:
  enabled: true
  release-monitor:
    identifier: 9272

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        i2cdetect -V
        i2cdump -V
        i2cget -V
        i2cset -V
        i2ctransfer -V
