package:
  name: ini-file
  version: 1.4.7
  epoch: 2
  description: CLI tool for modifying .ini files
  copyright:
    - license: Apache-2.0

pipeline:
  - uses: git-checkout
    with:
      expected-commit: b896bd80ef32cc3feb5a489f0606555169131de8
      repository: https://github.com/bitnami/ini-file
      tag: v${{package.version}}

  - uses: go/build
    with:
      ldflags: -X main.commit=$(git rev-parse HEAD) -X main.buildDate=$(date -u -d "@${SOURCE_DATE_EPOCH:-$(date +%s)}" "+%Y-%m-%dT%H:%M:%SZ")
      output: ini-file
      packages: .

update:
  enabled: true
  github:
    identifier: bitnami/ini-file
    strip-prefix: v

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        cat <<ini > expected.ini
        [My book]
        title=A wonderful book
        author=Bitnami
        rate=very good
        ini

        ini-file set --section "My book" --key "title" --value "A wonderful book" ./my.ini
        ini-file set -s "My book" -k "author" -v "Bitnami" ./my.ini
        ini-file set -s "My book" -k "rate" -v "very good" ./my.ini

        # Compare files
        if ! diff_output=$(diff -u my.ini expected.ini); then
          echo "Files differ:"
          echo "$diff_output"
          exit 1
        else
          echo "Files are identical."
        fi
