package:
  name: libnbd
  description: NBD client library in userspace
  url: https://gitlab.com/nbdkit/libnbd
  version: "1.23.7"
  epoch: 0
  copyright:
    - license: LGPL-2.1-only

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - libtool
      - wolfi-baselayout

vars:
  channel: "development"

var-transforms:
  - from: ${{package.version}}
    match: ^(\d.\d+).*
    replace: $1
    to: major_version

pipeline:
  # NOTE: not using git checkout because we would need ocalmc to generate some source files
  - uses: fetch
    with:
      uri: https://download.libguestfs.org/libnbd/${{vars.major_version}}-${{vars.channel}}/${{package.name}}-${{package.version}}.tar.gz
      expected-sha512: a09a3e273829f17f5ba4b7f723afe31704ecd415f08056b308afd064358816548248cf943060acbe308ad581d4a8d236668606907bfc27f49021238a75897fc6
      strip-components: 1

  - uses: autoconf/configure

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: "libnbd-static"
    description: "libnbd static libraries"
    pipeline:
      - uses: split/static

  - name: "libnbd-dev"
    description: "libnbd development headers"
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/tw/ldd-check

test:
  pipeline:
    - uses: test/tw/ldd-check

update:
  enabled: true
  release-monitor:
    identifier: 371504
