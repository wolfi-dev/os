package:
  name: libnbd
  description: NBD client library in userspace
  url: https://gitlab.com/nbdkit/libnbd
  version: "1.23.11"
  epoch: 0
  copyright:
    - license: LGPL-2.1-only

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - libtool
      - wolfi-baselayout

vars:
  channel: "development"

var-transforms:
  - from: ${{package.version}}
    match: ^(\d.\d+).*
    replace: $1
    to: major_version

pipeline:
  # NOTE: not using git checkout because we would need ocalmc to generate some source files
  - uses: fetch
    with:
      uri: https://download.libguestfs.org/libnbd/${{vars.major_version}}-${{vars.channel}}/${{package.name}}-${{package.version}}.tar.gz
      expected-sha512: 77b2c26c624690806bc202296dbe1b432bae3c0fc937b5d77cfd86e5100393e709c5a01e7a303eecd852209cc8d4b60fb8831a25ca5b9ffa20108c9a912c116d
      strip-components: 1

  - uses: autoconf/configure

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: "libnbd-static"
    description: "libnbd static libraries"
    pipeline:
      - uses: split/static

  - name: "libnbd-dev"
    description: "libnbd development headers"
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/tw/ldd-check

test:
  pipeline:
    - uses: test/tw/ldd-check

update:
  enabled: true
  release-monitor:
    identifier: 371504
