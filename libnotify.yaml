package:
  name: libnotify
  version: 0.8.3
  epoch: 4
  description: "GNOME/libnotify mirror"
  copyright:
    - license: LGPL-2.1-or-later

environment:
  contents:
    packages:
      - build-base
      - busybox
      - cairo-dev
      - dbus-dev
      - dbus-libs
      - fribidi-dev
      - gdk-pixbuf-dev
      - glib-dev
      - glib-gir
      - gobject-introspection-dev
      - gtk-3-dev
      - harfbuzz-dev
      - libxcomposite-dev
      - libxcursor-dev
      - libxdamage-dev
      - libxft-dev
      - libxrandr-dev
      - libxtst-dev
      - meson
      - openssf-compiler-options
      - pango-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/GNOME/libnotify
      tag: ${{package.version}}
      expected-commit: 6083790f9e0f1827147ecd8799c4dced0e86a877

  - uses: meson/configure
    with:
      opts: |
        -Dman=false -Dgtk_doc=false

  - uses: meson/compile

  - uses: meson/install

subpackages:
  - name: libnotify-dev
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf

update:
  enabled: true
  ignore-regex-patterns:
    - ".*@"
  github:
    identifier: GNOME/libnotify
    use-tag: true

test:
  environment:
    contents:
      packages:
        - build-base
        - pkgconf
        - libnotify-dev
  pipeline:
    - runs: |
        notify-send --version
        notify-send --help
    - name: "Test compilation with development files"
      runs: |
        cat > test.c << 'EOF'
        #include <libnotify/notify.h>
        #include <stdio.h>

        int main(void) {
            if (!notify_init("test-app")) {
                return 1;
            }

            /* Test version macros */
            printf("Notify version: %d.%d.%d\n",
                   NOTIFY_VERSION_MAJOR,
                   NOTIFY_VERSION_MINOR,
                   NOTIFY_VERSION_MICRO);

            notify_uninit();
            return 0;
        }
        EOF

        gcc $(pkg-config --cflags --libs libnotify) test.c -o test

        # Verify the binary was created
        test -x test
