package:
  name: libtirpc
  version: "1.3.7"
  epoch: 0
  description: Transport Independent RPC library (SunRPC replacement)
  copyright:
    - license: BSD-3-Clause

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - gcc-14-default
      - krb5-dev
      - libtool

pipeline:
  - uses: fetch
    with:
      expected-sha256: b47d3ac19d3549e54a05d0019a6c400674da716123858cfdb6d3bdd70a66c702
      uri: https://downloads.sourceforge.net/project/libtirpc/libtirpc/${{package.version}}/libtirpc-${{package.version}}.tar.bz2

  - uses: autoconf/configure
    with:
      opts: |
        --host=${{host.triplet.gnu}} \
        --build=${{host.triplet.gnu}} \
        --prefix=/usr \
        --sysconf=/etc

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: libtirpc-static
    pipeline:
      - uses: split/static
    description: libtirpc static

  - name: libtirpc-doc
    pipeline:
      - uses: split/manpages
    description: libtirpc manpages
    test:
      pipeline:
        - uses: test/docs

  - name: libtirpc-conf
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/etc
          mv ${{targets.destdir}}/etc/* ${{targets.subpkgdir}}/etc/
    description: Configuration files for TI-RPC

  - name: libtirpc-nokrb
    pipeline:
      - uses: autoconf/configure
        with:
          opts: |
            --host=${{host.triplet.gnu}} \
            --build=${{host.triplet.gnu}} \
            --prefix=/usr \
            --sysconf=/etc \
            --disable-gssapi \
            SONAME_SUFFIX='-nokrb'
      - uses: autoconf/make
      - runs: make install DESTDIR=${{targets.subpkgdir}}
      - uses: strip
    description: Transport Independent RPC library (SunRPC replacement) - without GSS-API/Kerberos
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: libtirpc-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libtirpc
        - krb5-dev
        - libtirpc-conf
    description: libtirpc dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

update:
  enabled: true
  release-monitor:
    identifier: 1740

test:
  pipeline:
    - uses: test/tw/ldd-check
