package:
  name: libtommath
  version: 1.3.0
  epoch: 0
  description: LibTomMath is a free open source portable number theoretic multiple-precision integer library written entirely in C
  copyright:
    - license: Unlicense

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle

pipeline:
  - uses: git-checkout
    with:
      expected-commit: 95d80fd8229d05dd6cb4ec88bc8d4f5377ff00ef
      repository: https://github.com/libtom/libtommath/
      tag: v${{package.version}}

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: ${{package.name}}-dev
    description: "headers for libtommath"
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - libtommath
    test:
      environment:
        contents:
          packages:
            - glibc-dev
            - gcc
      pipeline:
        - name: libtommath headers file
          runs: |
            stat /usr/local/include/tommath.h
            stat /usr/local/lib/libtommath.a
        - name: run a simple test
          runs: |
            cat <<EOF > simple_test.c
            #include <stdio.h>
            #include <tommath.h>

            int main() {
                mp_int a, b, c;
                char result[100];

                mp_init_multi(&a, &b, &c, NULL);  // Initialize multiple integers
                mp_set(&a, 12345);
                mp_set(&b, 67890);
                mp_add(&a, &b, &c);              // c = a + b

                mp_toradix(&c, result, 10);      // Convert result to string
                printf("Result: %s\n", result);

                mp_clear_multi(&a, &b, &c, NULL);  // Clear memory
                return 0;
            }
            EOF

            gcc -o simple_test simple_test.c -ltommath
            ./simple_test

update:
  enabled: true
  github:
    identifier: libtom/libtommath
    strip-prefix: v
