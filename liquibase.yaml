package:
  name: liquibase
  version: "4.31.1"
  epoch: 0
  description: "Liquibase is a database schema change management solution that enables you to revise and release database changes faster and safer from development to production."
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - bash
      - openjdk-17-jre

environment:
  contents:
    packages:
      - bash
      - build-base
      - busybox
      - maven
      - openjdk-17
      - wolfi-base
  environment:
    LANG: en_US.UTF-8
    JAVA_HOME: /usr/lib/jvm/java-17-openjdk

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/liquibase/liquibase
      tag: v${{package.version}}
      expected-commit: 12ab20b176e5659622c240b4ba4f056ccf17c27d

  - name: Build
    runs: |
      # Build liquibase
      ./mvnw -B clean package -DskipTests=true -P !liquibase-commercial
  
  - name: Install
    runs: |
      # Setup destination dir
      mkdir -p ${{targets.destdir}}/usr/share/java/liquibase
      tar -zxvf liquibase-dist/target/${{package.name}}-0-SNAPSHOT.tar.gz -C ${{targets.destdir}}/usr/share/java/liquibase

  - name: Create symlinks for liquibase
    runs: |
      ln -sf /usr/share/java/liquibase ${{targets.destdir}}/liquibase
      mkdir -p ${{targets.destdir}}/opt/java/openjdk
      for item in bin conf legal lib release; do
        ln -sf /usr/lib/jvm/java-17-openjdk/$item ${{targets.destdir}}/opt/java/openjdk
      done

  - uses: strip

update:
  enabled: true
  github:
    identifier: liquibase/liquibase
    strip-prefix: v
