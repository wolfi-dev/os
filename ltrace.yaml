package:
  name: ltrace
  version: 0.7.3
  epoch: 3
  description: Tracks runtime library calls in dynamically linked programs
  copyright:
    - license: GPL-2.0-or-later

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - elfutils-dev
      - libtool

pipeline:
  - uses: fetch
    with:
      expected-sha256: 0e6f8c077471b544c06def7192d983861ad2f8688dd5504beae62f0c5f5b9503
      uri: https://www.ltrace.org/ltrace_${{package.version}}.orig.tar.bz2

  # Add support for tracing on aarch64
  - uses: patch
    with:
      patches: ltrace_aarch64.patch

  - runs: |
      libtoolize --force && aclocal && autoconf && automake --add-missing

  - uses: autoconf/configure
    with:
      opts: |
        --disable-werror

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: ltrace-doc
    pipeline:
      - uses: split/manpages
    test:
      pipeline:
        - uses: test/docs

update:
  enabled: true
  # Release monitor started picking up 'dev' releases, from here: https://tracker.debian.org/pkg/ltrace.
  # They have 'git' in the release, so we're ignoring them here.
  ignore-regex-patterns:
    - '.*git.*'
  release-monitor:
    identifier: 117364

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        ltrace --version
        ltrace --help
