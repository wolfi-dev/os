package:
  name: mamba
  version: 2.1.0
  epoch: 0
  description: mamba is a reimplementation of the conda package manager in C++.
  copyright:
    - license: BSD-3-Clause
  dependencies:
    provider-priority: 0

environment:
  contents:
    packages:
      - build-base
      - busybox
      - cli11
      - curl-dev
      - fmt-dev
      - libarchive-dev
      - libsolv-dev
      - nlohmann-json
      - python-3
      - reproc
      - reproc++
      - simdjson-dev
      - spdlog-dev
      - tl-expected
      - yaml-cpp-dev
      - zstd-static

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/mamba-org/mamba
      tag: ${{package.version}}
      expected-commit: 60ad28aa11256fb7c6e2de324eaf4b835cf9421d

  - uses: cmake/configure
    with:
      opts: |
        -DBUILD_SHARED=ON \
        -DBUILD_STATIC=OFF \
        -DBUILD_LIBMAMBA=ON \
        -DBUILD_MAMBA=ON \
        -DBUILD_MICROMAMBA=OFF \
        -DBUILD_MAMBA_PACKAGE=OFF

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

update:
  enabled: true
  ignore-regex-patterns:
    - \.rc[0-9]+$
    - ^(mamba|micromamba|libmambapy|libmamba)
    - ^(\d{4})\.
  github:
    identifier: mamba-org/mamba

test:
  pipeline:
    - uses: test/tw/ldd-check
    - runs: |
        mamba info
        mamba create -n test-env jupyter
        mamba run -n test-env jupyter --help
