package:
  name: neuvector-scanner
  version: 0_git20240417
  epoch: 0
  description: NeuVector vulnerability scanner for the SUSE NeuVector Container Security Platform
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - go

pipeline:
  - uses: fetch
    with:
      expected-sha256: f616895dd7737b60f74eb520dda71996dc050720fb4c67fea906a845c23aa867
      uri: https://github.com/neuvector/scanner/archive/ad2e622edd04a04981813076f4f5b23b407593f4.tar.gz

  - uses: go/bump
    with:
      deps: github.com/containerd/containerd@v1.6.26 github.com/docker/docker@v26.0.0 github.com/opencontainers/image-spec@v1.1.0 github.com/opencontainers/runc@v1.1.12 golang.org/x/net@v0.17.0 google.golang.org/grpc@v1.56.3 google.golang.org/protobuf@v1.33.0 github.com/docker/distribution@v2.8.2-beta.1+incompatible golang.org/x/sys@v0.19.0

  - uses: go/build
    with:
      modroot: .
      packages: .
      output: ${{package.name}}
      vendor: true

  - uses: strip

subpackages:
  - name: ${{package.name}}-task
    description: NeuVector Scanner Task
    pipeline:
      - uses: go/build
        with:
          modroot: .
          packages: .
          output: ${{package.name}}-task
          subpackage: "true"
          vendor: true

  - name: ${{package.name}}-monitor
    description: NeuVector Scanner Monitor
    pipeline:
      - runs: |
          make -C monitor
          mkdir -p ${{targets.contextdir}}/usr/local/bin
          install -Dm755 monitor/monitor ${{targets.contextdir}}/usr/local/bin/${{package.name}}-monitor

test:
  pipeline:
    - runs: ${{package.name}} --help

update:
  enabled: false # No releases or tags
