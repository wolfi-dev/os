package:
  name: nginx-s3-gateway
  version: 0_git20250605
  epoch: 0
  description: NGINX S3 Gateway
  copyright:
    - license: Apache-2.0
  # BYO nginx
  dependencies:
    provides:
      - nginx-config=0.${{package.full-version}}
    runtime:
      - njs
      - libedit
      - bash
      - curl

# Based off of https://github.com/nginx/nginx-s3-gateway/blob/main/Dockerfile.oss
environment:
  contents:
    packages:
      - busybox

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/nginx/nginx-s3-gateway.git
      expected-commit: 5652fa1d1be939f846de05a33e9651a0e601f259
      branch: main

  - name: Copy configurations
    runs: |
      NGINX_DIRECTORY=${{targets.contextdir}}/etc/nginx
      install -Dpm0644 -t "${NGINX_DIRECTORY}/conf.d/gateway/" ./oss/etc/nginx/conf.d/gateway/server_variables.conf
      install -Dpm0644 -t "${NGINX_DIRECTORY}/templates/" ./oss/etc/nginx/templates/upstreams.conf.template

      install -Dpm0644 -t "${NGINX_DIRECTORY}/include/" ./common/etc/nginx/include/*.js
      install -Dpm0644 -t "${NGINX_DIRECTORY}/templates/gateway/" ./common/etc/nginx/templates/gateway/*.template
      install -Dpm0644 -t "${NGINX_DIRECTORY}/templates/" ./common/etc/nginx/templates/*.template
      install -Dpm0644 -t "${NGINX_DIRECTORY}/" ./common/etc/nginx/nginx.conf

subpackages:
  - name: ${{package.name}}-oci-entrypoint
    description: Entrypoint for NGINX s3 gateway image
    pipeline:
      - runs: |
          install -Dpm0755 -t ${{targets.subpkgdir}}/ common/docker-entrypoint.sh
          install -Dpm0755 -t ${{targets.subpkgdir}}/docker-entrypoint.d/ ./common/docker-entrypoint.d/*.sh

update:
  enabled: false
  exclude-reason: No releases or tags
  schedule:
    period: daily
    reason: Upstream does not maintain tags or releases
  github:
    identifier: nginx/nginx-s3-gateway
