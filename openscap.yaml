package:
  name: openscap
  version: 1.4.0
  epoch: 2
  description: NIST Certified SCAP 1.2 toolkit
  copyright:
    - license: LGPL-2.1-or-later

environment:
  contents:
    packages:
      - acl-dev
      - asciidoc
      - build-base
      - busybox
      - ca-certificates-bundle
      - cmake
      - curl-dev
      - dbus-dev
      - doxygen
      - glib-dev
      - graphviz
      - graphviz-dev
      - libbz2-1
      - libcap-dev
      - libgcrypt-dev
      - libnss-dev
      - libproc-2-0
      - libxml2-dev
      - libxslt-dev
      - openldap-dev
      - openssf-compiler-options
      - openssl-dev
      - perl-dev
      - perl-xml-parser
      - popt-dev
      - procps
      - py3-gv
      - py3-setuptools
      # TODO: Needed for rpm/apt scanning
      # - perl-xml-xpath
      # - opendbx-dev
      # - rpm-dev
      # - apt-dev
      # - libselinux
      - python3-dev
      - samurai
      - swig
      - systemd-dev
      - util-linux-dev
      - xmlsec-dev
      - xmlsec-openssl
      - yaml-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/OpenSCAP/openscap
      expected-commit: a01b5d6927c7bccf41d9c623fee0c5f7105db835
      tag: ${{package.version}}

  - uses: cmake/configure
    with:
      opts: |
        -DCMAKE_BUILD_TYPE=None \
        -DENABLE_PERL=OFF \
        -DENABLE_TESTS=OFF \
        -DWITH_PCRE2=True

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: ${{package.name}}-docker
    description: "A virtual with all the oscap-docker dependencies present"
    dependencies:
      runtime:
        - openscap
        - py3-docker
        - docker-cli

# TODO: Requires some additional graphviz/xml packages
# - name: ${{package.name}}-doc
#   description: "OpenSCAP documentation"
#   pipeline:
#     - uses: split/manpages
update:
  enabled: true
  github:
    identifier: OpenSCAP/openscap

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        oscap --version
        oscap --help
    - uses: test/pkgconf
