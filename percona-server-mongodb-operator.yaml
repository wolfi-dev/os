package:
  name: percona-server-mongodb-operator
  version: "1.19.1"
  epoch: 0
  description: Kubernetes Operator which deploys and manages Percona Server for MongoDB on Kubernetes clusters.
  copyright:
    - license: Apache-2.0

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/percona/percona-server-mongodb-operator.git
      tag: v${{package.version}}
      expected-commit: 5670cbfe7e9c84ea1da7ad2417e4604b359b4633

  - uses: go/build
    with:
      packages: ./cmd/manager/main.go
      output: percona-server-mongodb-operator

subpackages:
  - name: ${{package.name}}-mongodb-healthcheck
    description: mongodb-healthcheck binary for percona-server-mongodb-operator
    pipeline:
      - uses: go/build
        with:
          packages: ./cmd/mongodb-healthcheck/main.go
          output: mongodb-healthcheck

update:
  enabled: true
  github:
    identifier: percona/percona-server-mongodb-operator
    strip-prefix: v

test:
  environment:
    contents:
      packages:
        - ${{package.name}}-mongodb-healthcheck
  pipeline:
    - runs: |
        percona-server-mongodb-operator --help
        mongodb-healthcheck --help
