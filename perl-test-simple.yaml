package:
  name: perl-test-simple
  version: "1.302219"
  epoch: 0
  description: Basic utilities for writing tests
  copyright:
    - license: GPL-1.0-or-later OR Artistic-1.0-Perl
  dependencies:
    runtime:
      - perl
    provides:
      - perl-test2-suite=${{package.full-version}}

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - perl

pipeline:
  - uses: fetch
    with:
      expected-sha512: 17c9c502b57cebd063ecdb04d3e8bf0d9571690fdc7a36fedb43f4489fda80e11b4f10805488db43e3b916d6b742b9c605b521f959118f8d2bf2a3d9b3309f4c
      uri: https://cpan.metacpan.org/authors/id/E/EX/EXODIST/Test-Simple-${{package.version}}.tar.gz

  - uses: perl/make

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: perl/cleanup

  - uses: strip

test:
  pipeline:
    - runs: |
        cat > expect_pass.pl << 'EOF'
        #!/usr/bin/perl -w
        use Test::Simple tests => 1;
        ok( 1 + 1 == 2 );
        EOF

        perl expect_pass.pl
    - runs: |
        cat > expect_fail.pl << 'EOF'
        #!/usr/bin/perl -w
        use Test::Simple tests => 2;
        ok( 1 + 1 == 2 );
        ok( 1 + 1 == 3 );
        EOF

        perl expect_fail.pl && { echo "Expected tests to fail"; exit 1; }

update:
  enabled: true
  release-monitor:
    identifier: 11977

subpackages:
  - name: perl-test-simple-doc
    description: perl-test-simple documentation
    pipeline:
      - uses: split/manpages
    test:
      pipeline:
        - uses: test/docs
