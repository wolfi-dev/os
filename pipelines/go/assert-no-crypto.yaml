name: Assert that a Go module does not import any crypto packages

# do not include 'go' in 'needs.packages'.
# some packages pin to an older version; assume it gets injected elsewhere.
needs:
  packages:
    - grep

inputs:
  modroot:
    description: The root of the module
    default: .

pipeline:
  - runs: |
      cd "${{inputs.modroot}}"

      echo Checking crypto is not used
      [ -z "$(go build -a -n 2>&1 | grep 'packagefile crypto=')" ]
