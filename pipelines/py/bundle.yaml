name: Install Python packages with UV

needs:
  packages:
    - python-${{inputs.python-version}}-base
    - uv

inputs:
  dependencies:
    description: "Indirect dependencies to install."
    default: ""
  package:
    description: "Name of packages to install."
    required: true
  python-version:
    description: "Python version to use."
    required: true
  version:
    description: "Version of package to install."
    required: true

pipeline:
  - runs: |
      # Set Python version
      export "UV_PYTHON=${{inputs.python-version}}"

      # Install package
      mkdir -p ${{targets.contextdir}}
      uv pip install \
        --config-file /etc/uv/uv.toml \
        --system --prefix ${{targets.contextdir}}/usr \
        ${{inputs.package}}==${{inputs.version}} \
        ${{inputs.dependencies}}

      # Remove lockfile
      rm ${{targets.contextdir}}/usr/.lock
