name: Install individual Python packages with uv

needs:
  packages:
    - busybox
    - uv

inputs:
  package:
    description: "Name of package to install."
    default: ""
  python:
    description: "Python version to use."
    default: "/usr/bin/python3"

pipeline:
  - runs: |
      # Default to package.name if package not specified
      package="${{inputs.package}}"
      if [ -z "$package" ]; then
        package="${{package.name}}"
      fi

      # Set Python path
      export "UV_PYTHON=${{inputs.python}}"

      # Install package
      mkdir -p "${{targets.contextdir}}"
      uv pip install \
        --config-file /etc/uv/uv.toml --no-deps \
        --system --prefix "${{targets.contextdir}}/usr" \
        "${{inputs.package}}==${{package.version}}"

      # Remove lockfile
      rm "${{targets.contextdir}}/usr/.lock"
