name: Package target in virtual environment

needs:
  packages:
    - python-${{inputs.py-version}}-base
    - uv

inputs:
  package:
    description: "Name of package to install."
    required: true
  py-version:
    description: "Python version to use."
    required: true

pipeline:
  - uses: auth/uv

  - runs: |
      # Don't allow uv to download Python
      export "UV_PYTHON_DOWNLOADS=never"

      # Set Python version
      export "UV_PYTHON=${{inputs.py-version}}"

      # Install package
      mkdir -p ${{targets.contextdir}}
      uv pip${{range.key}} install --no-deps --prefix ${{targets.contextdir}}/usr ${{inputs.package}}==${{package.version}}
