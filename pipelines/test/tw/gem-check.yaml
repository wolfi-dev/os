# Note -- we're not going to require 'ruby' or 'gem' here, because:
#   - these packages should depend on the correct version of ruby and gem
#     and the tests should fail otherwise...:
name: Ruby Gem Installation Verification

description: |
  Validates that a Ruby gem can be properly required and loaded after installation.
  This test verifies gem installation integrity by attempting to require the gem in a Ruby environment.
  The gem name is auto-detected from the package name but can be overridden for packages that install
  multiple gems or use different naming conventions.

needs:
  packages:
    - gem-check

inputs:
  package:
    description: |
      Package name containing the Ruby gem to test.
      Defaults to the current package being built.
    required: false
    default: "${{context.name}}"
  require:
    description: |
      Exact gem name(s) to test requiring (comma or space-separated).
      Overrides the auto-detected gem name from the package.
      Use this when the gem name differs from the package name or when testing multiple gems.
    required: false
    default: ""

# USAGE EXAMPLES:
#
# Basic check (auto-detect gem name from package):
#   - uses: test/tw/gem-check
#
# Specify exact gem name:
#   - uses: test/tw/gem-check
#     with:
#       require: "activesupport"
#
# Test multiple gems:
#   - uses: test/tw/gem-check
#     with:
#       require: "rails activerecord actionpack"
#
pipeline:
  - name: check a ruby gem installation
    runs: |
      gem-check --package "${{inputs.package}}" --require "${{inputs.require}}"
