name: C/C++ Header File Compilation Check

description: |
  Verifies that C/C++ header files can be successfully included and compiled.
  This test ensures header files have correct syntax, proper includes, and compile cleanly.
  Useful for validating -dev packages that provide header files for library development.
  Can test entire packages or specific header files, with optional custom configure options.

needs:
  packages:
    - header-check

inputs:
  packages:
    description: |
      Space-separated list of package names whose header files should be validated.
      All header files in these packages will be tested for compilability.
    required: false
    default: "${{context.name}}"
  files:
    description: |
      Space-separated list of specific header file names to check (alternative to checking entire packages).
      Use this to test specific problematic headers or for more targeted validation.
    required: false
    default: ""
  configure-opts:
    description: |
      Additional compiler or configure options required for compiling these headers.
      Use this for headers that need special flags, include paths, or defines (e.g., "-DFEATURE_X -I/usr/include/custom").
    required: false
    default: ""

# USAGE EXAMPLES:
#
# Basic check (all headers in current package):
#   - uses: test/tw/header-check
#
# Check specific header files:
#   - uses: test/tw/header-check
#     with:
#       files: "mylib.h mylib-internal.h"
#
# Check with custom compiler flags:
#   - uses: test/tw/header-check
#     with:
#       configure-opts: "-DENABLE_FEATURE_X -I/usr/include/opencv4"
#
pipeline:
  - name: check header files using header-check
    runs: |
      if [ -z "${{inputs.files}}" ]; then
        header-check --packages="${{inputs.packages}}" --configure-opts="${{inputs.configure-opts}}"
      else
        header-check --files="${{inputs.files}}" --configure-opts="${{inputs.configure-opts}}"
      fi
