name: Binary Version Validator

description: |
  Verifies binaries report correct version information matching the package version.
  This test ensures command-line tools properly implement version reporting by testing common version flags
  (--version, -V, etc.) and validates the output contains the expected version string. Critical for ensuring
  version consistency between package metadata and binary output.

needs:
  packages:
    - ver-check

inputs:
  bins:
    description: |
      Binary names to check for version, one per line.
      Can be a single binary or multiple binaries.
      Examples:
        Single: "nginx"
        Multiple:
          bins: |
            gcc
            g++
            cpp
    required: true
  version:
    description: |
      Expected version string to match in the binary's version output.
      Defaults to package version. Can be overridden for specific version formats.
    required: false
    default: ${{package.version}}
  version-flag:
    description: |
      Command line flag used to get version information.
      Use 'auto' to try common flags automatically: --version, -version, -V, -v, version
      Or specify exact flag like: --version, -V, etc.
    required: false
    default: "auto"
  match-type:
    description: |
      How to match the version string:
      - 'contains': Check if version string appears anywhere in output (default)
      - 'exact': Require exact match of entire output
      - 'regex': Use version as regex pattern
    required: false
    default: "contains"
  verbose:
    description: |
      Whether or not the output should be verbose
    required: false
    default: false

# USAGE EXAMPLES:
#
# Single binary:
#   - uses: test/tw/ver-check
#     with:
#       bins: ${{package.name}}
#
# Multiple binaries:
#   - uses: test/tw/ver-check
#     with:
#       bins: "gcc g++ cpp"
#       version: "gcc (GCC) ${{package.version}}"
pipeline:
  - name: "check version information for binaries"
    runs: |
      ver-check \
          --bins="${{inputs.bins}}" \
          --version="${{inputs.version}}" \
          --version-flag="${{inputs.version-flag}}" \
          --match-type="${{inputs.match-type}}" \
          --verbose="${{inputs.verbose}}"
