name: Service File Validation

description: |
  Validates systemd service files, unit files, and related service configuration.
  This test checks that service files are properly formatted, contain required sections,
  and follow systemd best practices. Can optionally skip specific files or include
  documentation tests for service man pages.

needs:
  packages:
    - verify-service

inputs:
  skip-files:
    description: |
      Space-separated list of service file names to exclude from validation.
      Use this to skip files that have known issues or don't follow standard formats.
    default: ""
  man:
    description: |
      Include documentation tests in verification (default: false, skips doc tests).
      Set to "true" to verify that service files have corresponding man pages.
    default: "false"

# USAGE EXAMPLES:
#
# Basic check (all service files in package):
#   - uses: test/tw/verify-service
#
# Skip specific problematic files:
#   - uses: test/tw/verify-service
#     with:
#       skip-files: "legacy.service test.socket"
#
# Include documentation checks:
#   - uses: test/tw/verify-service
#     with:
#       man: "true"
#
pipeline:
  - name: Verify Service files
    runs: |
      verify-service \
        --package '${{context.name}}' \
        --skip-files '${{inputs.skip-files}}' \
        --man ${{inputs.man}}
