package:
  name: pipewire
  version: 1.4.7
  epoch: 0
  description: Multimedia processing graphs
  copyright:
    - license: MIT

environment:
  contents:
    packages:
      - alsa-lib-dev
      - avahi-dev
      - bluez-dev
      - build-base
      - dbus-dev
      - doxygen
      - fdk-aac-dev
      - glib-dev
      - gst-plugins-base-dev
      - gstreamer-dev
      - ldacbt-dev
      - libcamera-dev
      - libcanberra-dev
      - libfreeaptx-dev
      - liblc3-dev
      - libmysofa-dev
      - libsndfile-dev
      - libusb-dev
      - libxcb-dev
      - libxfixes-dev
      - lilv-dev
      - openssl-dev
      - opus-dev
      - pulseaudio-dev
      - readline-dev
      - sbc-dev
      - systemd-dev
      - webrtc-audio-processing-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.freedesktop.org/pipewire/pipewire.git
      tag: ${{package.version}}
      expected-commit: 1c542e9a0ca4226c9befb08fe9c19170aca3ce95

  - uses: meson/configure
    with:
      opts: |
        --auto-features=enabled \
        -Ddocs=disabled \
        -Dman=enabled \
        -Dsdl2=disabled \
        -Dsystemd=disabled \
        -Dlibffado=disabled \
        -Droc=disabled \
        -Dselinux=disabled \
        -Dsnap=disabled \
        -Debur128=disabled \
        -Dbluez5-codec-lc3plus=disabled \
        -Djack=disabled \
        -Djack-devel=true \
        -Dlibjack-path=/usr/lib \
        -Dlibv4l2-path=/usr/lib \
        -Dudevrulesdir=/usr/lib/udev/rules.d \
        -Dsession-managers=[] \
        -Drlimits-match=@_pipewire

  - uses: meson/compile

  - uses: meson/install

  - uses: strip

update:
  enabled: true
  release-monitor:
    identifier: 57357

subpackages:
  - name: ${{package.name}}-dev
    description: ${{package.name}} development libraries and headers
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

test:
  pipeline:
    - uses: test/tw/ldd-check
