From 7fb97a5006927696e75891282d489815cd6d786a Mon Sep 17 00:00:00 2001
From: Kyle Steere <kyle.steere@chainguard.dev>
Date: Fri, 7 Feb 2025 09:26:11 -0600
Subject: [PATCH] updating proxyAgent for unknown

Signed-off-by: Kyle Steere <kyle.steere@chainguard.dev>
---
 packages/http/src/forwarder/index.ts | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/packages/http/src/forwarder/index.ts b/packages/http/src/forwarder/index.ts
index 724eebf3..52602603 100644
--- a/packages/http/src/forwarder/index.ts
+++ b/packages/http/src/forwarder/index.ts
@@ -22,6 +22,7 @@ import * as createHttpsProxyAgent from 'https-proxy-agent';
 import { toURLSearchParams } from '../utils/url';
 import { logRequest, logResponse } from '../utils/logger';
 import * as chalk from 'chalk';
+import { HttpProxyAgent } from 'http-proxy-agent';

 const { version: prismVersion } = require('../../package.json'); // eslint-disable-line

@@ -56,7 +57,7 @@ const forward: IPrismComponents<IHttpOperation, IHttpRequest, IHttpResponse, IHt
           );

           logForwardRequest({ logger, url, request: input });
-          let proxyAgent = undefined;
+          let proxyAgent = HttpProxyAgent as unknown as any;
           if (upstreamProxy) {
             proxyAgent =
               partialUrl.protocol === 'https:'
@@ -65,7 +66,7 @@ const forward: IPrismComponents<IHttpOperation, IHttpRequest, IHttpResponse, IHt
           }

           return fetch(url, {
-            agent: proxyAgent,
+            agent: new proxyAgent,
             body,
             method: input.method,
             headers: defaults(omit(input.headers, ['host']), {
--
2.43.0
