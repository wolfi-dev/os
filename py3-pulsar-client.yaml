package:
  name: py3-pulsar-client
  version: "3.8.0"
  epoch: 0
  description: Apache Pulsar Python client library
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - py3-certifi
      - python3

environment:
  contents:
    packages:
      - build-base
      - busybox
      - libpulsar-dev
      - py3-build-base-dev
      - py3-pybind11-dev
      - python3

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/apache/pulsar-client-python
      tag: v${{package.version}}
      expected-commit: b4b035dc33088b66645836d2df2f58aadc98089f

  - uses: cmake/configure
    with:
      opts: |
        -DPYBIND11_INCLUDE_DIRS=/usr/lib/python"$(python3 -c 'import sys; print(str(sys.version_info[0])+"."+str(sys.version_info[1]))')"/site-packages/pybind11/include
      output-dir: $(pwd)

  - uses: cmake/build
    with:
      output-dir: $(pwd)

  - uses: py/pip-build-install

  - uses: strip

update:
  enabled: true
  github:
    identifier: apache/pulsar-client-python
    strip-prefix: v
    strip-suffix: -candidate1

test:
  pipeline:
    - uses: test/tw/ldd-check
    - uses: test/tw/pip-check
