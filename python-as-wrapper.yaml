package:
  name: python-as-wrapper
  version: 0.1.0
  epoch: 0
  description: Shell script wrapper to exec python3.XX
  copyright:
    - license: Apache-2.0

data:
  - name: py-versions
    items:
      3.10: '310'
      3.11: '311'
      3.12: '312'
      3.13: '313'
      3.14: '314'

  - name: python-as-names
    items:
      python: PYTHON_AS
      python3: PYTHON3_AS

environment:
  contents:
    packages:
      - busybox

pipeline:
  - runs: |
      chmod 755 write-strict write-env
      chmod 755 test-python3-as-env test-python3-as-wrapper

subpackages:
  - range: py-versions
    name: python3-as-${{range.key}}
    description: provides /usr/bin/python3 that execs python${{range.key}}
    dependencies:
      runtime:
        - python-${{range.key}}-base
    pipeline:
      - runs: |
          ./write-strict "python${{range.key}}" ${{targets.contextdir}}/usr/bin/python3
    test:
      environment:
        contents:
          packages:
            - python3-as-test
      pipeline:
        - name: validate wrapper 'python3' for ${{range.key}}
          runs: |
            python3 /usr/bin/test-python3-as-wrapper \
              python3 test-python3-as-wrapper ${{range.key}}

  - range: py-versions
    name: python-as-${{range.key}}
    description: provides /usr/bin/python that execs python${{range.key}}
    dependencies:
      runtime:
        - python-${{range.key}}-base
    pipeline:
      - runs: |
          ./write-strict "python${{range.key}}" ${{targets.contextdir}}/usr/bin/python
    test:
      environment:
        contents:
          packages:
            - python3-as-test
      pipeline:
        - name: validate wrapper 'python' for ${{range.key}}
          runs: |
            python /usr/bin/test-python3-as-wrapper \
              python test-python3-as-wrapper ${{range.key}}

  - range: python-as-names
    name: ${{range.key}}-as-env
    description: provides /usr/bin/${{range.key}} that execs env var ${{range.value}}
    pipeline:
      - runs: |
          ./write-env "${{range.value}}" ${{targets.contextdir}}/usr/bin/${{range.key}}
    test:
      environment:
        contents:
          packages:
            - python3-as-test
      pipeline:
        - name: validate wrapper '${{range.key}}'
          runs: |
            test-python3-as-env /usr/bin/${{range.key}} ${{range.value}} ${{range.key}}

  - name: python3-as-test
    description: provides the tests for this package
    pipeline:
      - runs: |
          install -D -m755 "-t${{targets.contextdir}}/usr/bin" test-*

  - name: check-shbang
    description: simple script to check shbang values
    pipeline:
      - runs: |
          install -D -m755 "-t${{targets.contextdir}}/usr/bin" check-shbang

update:
  enabled: false
  exclude-reason: No source to watch for the new versions - this is the source.
