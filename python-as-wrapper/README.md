# python-as-wrapper

In a "normal" installation of python, 'python3' is a symlink
to 'pythonX.Y' where X.Y is Major.Minor (3.13).  In that scenario,
if caller invokes 'python3', then when python reads its sys.executable,
the executable is 'python3'.

The value of sys.executable is "sticky" and finds its way into shbangs that
are installed with 'pip install' or other places.

In the vast majority of places, we do not want shbang with
/usr/bin/python3 because at runtime:
 * python3 might be a symlink to another python version
 * python3 may not exist at all - with only python3.XX installed.
 * melange does not recognize
 * If the package has any dependencies, those might be installed
   with a different python3.X is provided by the version of python
   that "owns" /usr/bin/python3 at runtime.

This wrapper package provides 'python3' and 'python' executables in `/usr/bin`
that then invoke the appropriate 'python3.X' program via exec so that
any python code that determines the arg0 will find 'python3.X' rather than 'python3'.

As a specific example, these wrappers will cause the scripts generated by
'python3 -m pip install pkg' to be generated with a shbang of
`/usr/bin/python3.Y` instead of `/usr/bin/python3`.

Note: None of these packages are intended for runtime production use.
They are intended to be used to accomodate package build systems
That invoke 'python3' or 'python'.

When possible, prefer the `python3` version of the wrappers to the _completely_
unversioned `python` version.

## python3-as-python3.X and python-as-python3.X packages
For explanation, consider specific packges
 * `python3-as-python3.13`
 * `python-as-python3.13`

These packages both depend on `python-3.13-base`.
`python3-as-python3.13` installs a shell script in `/usr/bin/python3`
with:

    #!/bin/sh
    exec python3.13 "$@"

`python-as-python3.13` installs the same shell script into `/usr/bin/python`


This way, anything that calls `python3` or `python` will have `python3.13`
as the `sys.executable`.

## python3-as-env and python-as-env packages
The python3-as-env and python-as-env packages are a bit more complicated.
They install `/usr/bin/python3` and `/usr/bin/python` with a wrapper
that uses the environment variable `PYTHON3_AS` or `PYTHON_AS`.

Thus, you can install `python3-as-env` and use it in a multi-versioned
python by setting PYTHON3_AS to a specific `python3.13`.

Valid examples of environment variables:

    * `PYTHON3_AS=python3.13`
    * `PYTHON_AS=python3.10`

## check-shbang
This package provides a simple script to verify that shbangs contain
expected values.

It can easily be run from a test environment like:

```yaml
test:
  environment:
    contents:
      packages:
        - check-shbang
      pipeline:
        - runs: |
            check-shbang python3.13 /usr/bin/my-entry-point
```
