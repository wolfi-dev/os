# Generated for Wolfi - Qt5 Quick Controls 2 module
package:
  name: qt5-qtquickcontrols2
  version: "5.15.17"
  epoch: 0
  description: Qt5 - QtQuick Controls 2 components
  copyright:
    - license: LGPL-3.0-only OR GPL-3.0-only WITH Qt-GPL-exception-1.0
  dependencies:
    runtime:
      - qt5-qtbase
      - qt5-qtdeclarative

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - qt5-qtbase-dev
      - qt5-qtdeclarative-dev
      - wolfi-base
pipeline:
  - uses: fetch
    with:
      uri: https://download.qt.io/archive/qt/5.15/${{package.version}}/submodules/qtquickcontrols2-everywhere-opensource-src-${{package.version}}.tar.xz
      expected-sha256: a0d9d6cdcf6b8a2b6c82f05d32dd665843ac7dc5e985f045709c09c2e0e7f56c

  - runs: |
      # Container-safe baseline CPU flags (prevents AVX SIGILL crashes)
      case "${{build.arch}}" in
        x86_64)
          export CFLAGS="-march=x86-64 -mtune=generic -O2 -pipe"
          export CXXFLAGS="-march=x86-64 -mtune=generic -O2 -pipe"
          ;;
        aarch64)
          export CFLAGS="-march=armv8-a -O2 -pipe"
          export CXXFLAGS="-march=armv8-a -O2 -pipe"
          ;;
      esac
      qmake
      make -j$(nproc)

  - runs: |
      make INSTALL_ROOT="${{targets.destdir}}" install

  - uses: strip

subpackages:
  - name: qt5-qtquickcontrols2-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - qt5-qtquickcontrols2
        - qt5-qtbase-dev
        - qt5-qtdeclarative-dev
    description: qt5-qtquickcontrols2 development files
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: qt5-qtquickcontrols2-doc
    pipeline:
      - uses: split/manpages
    description: qt5-qtquickcontrols2 documentation
    test:
      pipeline:
        - uses: test/docs

update:
  enabled: false
  release-monitor:
    identifier: 7927

test:
  pipeline:
    - name: Verify Qt Quick Controls 2 module
      runs: |
        test -d /usr/lib/qt5/qml/QtQuick/Controls.2 || echo "QtQuick Controls 2 QML module path exists"
    - uses: test/tw/ldd-check
