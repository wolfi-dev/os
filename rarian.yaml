package:
  name: rarian
  version: 0.8.6
  epoch: 1
  description: Documentation meta-data library, designed as a replacement for Scrollkeeper.
  copyright:
    - license: GPL-2.0-or-later OR LGPL-2.1-or-later OR Zlib

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bash
      - build-base
      - busybox
      - ca-certificates-bundle
      - libxslt-dev
      - tinyxml2
      - tinyxml2-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: 9d4f7873009d2e31b8b1ec762606b12bee5526e1fe75de48e9495382bfef2bea
      uri: https://gitlab.freedesktop.org/rarian/rarian/-/releases/${{package.version}}/downloads/assets/rarian-${{package.version}}.tar.bz2

  - uses: autoconf/configure
    with:
      opts: |
        --host=${{host.triplet.gnu}} \
        --build=${{host.triplet.gnu}} \
        --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --enable-scrollkeeper-compat \
        --disable-static

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: rarian-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - rarian
        - bash
    description: rarian dev
    test:
      pipeline:
        - runs: |
            rarian-sk-config --version
            rarian-sk-config --help
            scrollkeeper-config --version
            scrollkeeper-config --help
        - uses: test/pkgconf

update:
  enabled: true
  release-monitor:
    identifier: 227350

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        rarian-example --version
        rarian-sk-gen-uuid --version
        rarian-sk-get-cl --version
        rarian-sk-get-content-list --version
        rarian-sk-get-extended-content-list --version
        rarian-sk-get-scripts --version
        rarian-sk-install --version
        rarian-sk-preinstall --version
        scrollkeeper-gen-seriesid --version
        scrollkeeper-get-cl --version
        scrollkeeper-get-content-list --version
        scrollkeeper-get-extended-content-list --version
        scrollkeeper-get-index-from-docpath --version
        scrollkeeper-get-toc-from-docpath --version
        scrollkeeper-get-toc-from-id --version
        scrollkeeper-install --version
        scrollkeeper-preinstall --version
        scrollkeeper-uninstall --version
        rarian-example --help
        rarian-sk-gen-uuid --help
        rarian-sk-get-cl --help
        rarian-sk-get-content-list --help
        rarian-sk-get-extended-content-list --help
        rarian-sk-get-scripts --help
        rarian-sk-install --help
        rarian-sk-preinstall --help
        scrollkeeper-gen-seriesid --help
        scrollkeeper-get-cl --help
        scrollkeeper-get-content-list --help
        scrollkeeper-get-extended-content-list --help
        scrollkeeper-get-index-from-docpath --help
        scrollkeeper-get-toc-from-docpath --help
        scrollkeeper-get-toc-from-id --help
        scrollkeeper-install --help
        scrollkeeper-preinstall --help
        scrollkeeper-uninstall --help
