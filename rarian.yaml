package:
  name: rarian
  version: 0.8.6
  epoch: 3 # go/wolfi-rsc/rarian
  description: Documentation meta-data library, designed as a replacement for Scrollkeeper.
  copyright:
    - license: GPL-2.0-or-later OR LGPL-2.1-or-later OR Zlib
  resources:
    cpu: "1"
    memory: 5Gi

environment:
  contents:
    packages:
      - autoconf
      - automake
      - bash
      - build-base
      - busybox
      - ca-certificates-bundle
      - libtool
      - libxslt-dev
      - pkgconf-dev
      - tinyxml2
      - tinyxml2-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.freedesktop.org/rarian/rarian
      tag: ${{package.version}}
      expected-commit: b256945b6201b98c7a5bf08a41e148465e9b70dd

  - runs: ./autogen.sh

  - uses: autoconf/configure
    with:
      opts: |
        --host=${{host.triplet.gnu}} \
        --build=${{host.triplet.gnu}} \
        --prefix=/usr \
        --sysconfdir=/etc \
        --localstatedir=/var \
        --enable-scrollkeeper-compat \
        --disable-static

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: rarian-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - rarian
        - bash
    description: rarian dev
    test:
      pipeline:
        - runs: |
            rarian-sk-config --version
            rarian-sk-config --help
            scrollkeeper-config --version
            scrollkeeper-config --help
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

update:
  enabled: true
  release-monitor:
    identifier: 227350

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        rarian-example --version
        rarian-sk-gen-uuid --version
        rarian-sk-get-cl --version
        rarian-sk-get-content-list --version
        rarian-sk-get-extended-content-list --version
        rarian-sk-get-scripts --version
        rarian-sk-install --version
        rarian-sk-preinstall --version
        scrollkeeper-gen-seriesid --version
        scrollkeeper-get-cl --version
        scrollkeeper-get-content-list --version
        scrollkeeper-get-extended-content-list --version
        scrollkeeper-get-index-from-docpath --version
        scrollkeeper-get-toc-from-docpath --version
        scrollkeeper-get-toc-from-id --version
        scrollkeeper-install --version
        scrollkeeper-preinstall --version
        scrollkeeper-uninstall --version
        rarian-example --help
        rarian-sk-gen-uuid --help
        rarian-sk-get-cl --help
        rarian-sk-get-content-list --help
        rarian-sk-get-extended-content-list --help
        rarian-sk-get-scripts --help
        rarian-sk-install --help
        rarian-sk-preinstall --help
        scrollkeeper-gen-seriesid --help
        scrollkeeper-get-cl --help
        scrollkeeper-get-content-list --help
        scrollkeeper-get-extended-content-list --help
        scrollkeeper-get-index-from-docpath --help
        scrollkeeper-get-toc-from-docpath --help
        scrollkeeper-get-toc-from-id --help
        scrollkeeper-install --help
        scrollkeeper-preinstall --help
        scrollkeeper-uninstall --help
    - uses: test/tw/ldd-check
