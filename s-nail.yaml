package:
  name: s-nail
  version: 14.9.25
  epoch: 0
  description: "S-nail provides a simple and friendly environment for sending and receiving mail."
  copyright:
    - license: HPND

environment:
  contents:
    packages:
      - build-base
      - busybox
      - posix-libc-utils

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/sdaoden/s-mailx.git
      tag: v${{package.version}}
      expected-commit: bf99a2bb04be7b3cfa57c47127a1d865dc7ec3be

  - runs: |
      set -x
      make VAL_PREFIX= config
      make build
      mkdir "${{targets.destdir}}/bin"
      cp /home/build/.obj/s-nail "${{targets.destdir}}/bin/s-nail"
      cp /home/build/.obj/s-nail-dotlock "${{targets.destdir}}/bin/s-nail-dotlock"
      mkdir "${{targets.destdir}}/etc"
      cp /home/build/.obj/urc.rc "${{targets.destdir}}/etc/s-nail.rc"

  - uses: strip

update:
  enabled: true
  github:
    identifier: sdaoden/s-mailx
    strip-prefix: v
    use-tag: true

test:
  environment:
    contents:
      packages:
        - build-base
        - busybox
  pipeline:
    - runs: |
        version=$(/bin/s-nail --version 2>/dev/null)
        echo "$version" | grep "${{package.version}}"
