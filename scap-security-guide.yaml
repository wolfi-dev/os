package:
  name: scap-security-guide
  version: 0.1.74
  epoch: 2
  description: Security automation content in SCAP, Bash, Ansible, and other formats
  copyright:
    - license: BSD-3-Clause
  resources:
    cpu: 16
    memory: 16Gi

environment:
  contents:
    packages:
      - build-base
      - busybox
      - libxml2-dev
      - openscap
      - pcre2-dev
      - py3-jinja2
      - py3-lxml
      - py3-pandas
      - py3-pyyaml
      - py3-setuptools
      - py3-sphinx
      - python-3

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/ComplianceAsCode/content
      expected-commit: 1bf21b05fa9581e8ca44e104e741e13fad3551ef
      tag: v${{package.version}}

  - uses: cmake/configure
    with:
      # TODO: RHEL# product suite is not compiling
      opts: |
        -DSSG_ANSIBLE_PLAYBOOKS_ENABLED=False \
        -DSSG_SHELLCHECK_BASH_FIXES_VALIDATION_ENABLED=False \
        -DSSG_BASH_SCRIPTS_ENABLED=False \
        -DSSG_BATS_TESTS_ENABLED=False \
        -DSSG_PRODUCT_RHEL7=False \
        -DSSG_PRODUCT_RHEL8=False \
        -DSSG_PRODUCT_RHEL9=False

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: scap-security-guide-doc
    description: scap-security-guide docs
    pipeline:
      - uses: split/manpages

update:
  enabled: true
  github:
    identifier: ComplianceAsCode/content
    strip-prefix: v
