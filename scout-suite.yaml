package:
  name: scout-suite
  version: 5.14.0
  epoch: 0
  description: Multi-Cloud Security Auditing Tool
  copyright:
    - license: GPL-2.0-only

environment:
  contents:
    packages:
      - build-base
      - busybox
      - gcc
      - libffi-dev
      - openssl
      - py3-pip
      - python-3-dev
  environment:
    SOURCE_DATE_EPOCH: 315532800

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/nccgroup/ScoutSuite
      tag: ${{package.version}}
      expected-commit: 7909f2fc6186063e5c9e7ddef8c4d7d1072c8f3d

  - runs: |
      sed -i 's/azure-identity==1.5.0/azure-identity==1.16.1/' requirements.txt

      pip3 install -r requirements.txt . --prefix=/usr --root="${{targets.contextdir}}"

      find ${{targets.contextdir}} -name "*.pyc" -exec rm -rf '{}' +

  - uses: strip

update:
  enabled: true
  github:
    identifier: nccgroup/ScoutSuite
    use-tag: true
    strip-prefix: v

test:
  pipeline:
    - name: Verify in-toto installation
      runs: |
        set -o pipefail
        scout --help
    - uses: test/tw/ldd-check
