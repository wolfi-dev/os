package:
  name: sssd
  description: "A daemon to manage identity, authentication and authorization for centrally-managed systems."
  version: "2.11.0"
  epoch: 0
  copyright:
    - license: GPL-3.0-only

environment:
  contents:
    packages:
      - bind-tools
      - build-base
      - busybox
      - c-ares-dev
      - cifs-utils-dev
      - ding-libs-dev
      - gettext-dev
      - keyutil-dev
      - krb5-dev
      - ldb-dev
      - libtool
      - linux-pam-dev
      - openldap-dev
      - pcre2-dev
      - pkgconf-dev
      - popt-dev
      - samba-dev
      - talloc-dev
      - tdb-dev
      - tevent-dev

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/SSSD/sssd.git
      tag: ${{package.version}}
      expected-commit: b9cdd65b7d404ac54b607b3d14a537c9a59b6052

  - uses: autoconf/configure
    with:
      opts: |
        --runstatedir=%{_rundir} \
        --disable-rpath \
        --disable-static \
        --enable-gss-spnego-for-zero-maxssf \
        --enable-nfsidmaplibdir=%{_libdir}/libnfsidmap \
        --enable-nsslibdir=%{_libdir} \
        --enable-pammoddir=%{_libdir}/security \
        --enable-sss-default-nss-plugin \
        --enable-systemtap \
        --with-db-path=%{dbpath} \
        --with-gpo-cache-path=%{gpocachepath} \
        --with-init-dir=%{_initrddir} \
        --with-initscript=systemd \
        --with-krb5-rcache-dir=%{_localstatedir}/cache/krb5rcache \
        --with-mcache-path=%{mcpath} \
        --with-pipe-path=%{pipepath} \
        --with-pubconf-path=%{pubconfpath} \
        --with-sssd-user=%{sssd_user} \
        --with-syslog=journald \
        --with-test-dir=/dev/shm

  - uses: autoconf/make
    with:
      opts: all docs runstatedir=/run

  - uses: autoconf/make-install

update:
  enabled: true
  github:
    identifier: SSSD/sssd
