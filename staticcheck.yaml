package:
  name: staticcheck
  version: 0.6.1
  epoch: 0
  description: Staticcheck is a state of the art linter for the Go programming language.
  copyright:
    - license: MIT
  dependencies:
    runtime:
      - go

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - go
  environment:
    CGO_ENABLED: "0"
    GOFLAGS: "-mod=readonly"

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/dominikh/go-tools
      tag: v0.6.1
      expected-commit: b8ec13ce4d00445d75da053c47498e6f9ec5d7d6 # verify this is correct for v0.6.1

  - runs: |
      cd cmd/staticcheck
      go build -trimpath -ldflags="-s -w" -o staticcheck
      install -Dm755 staticcheck "${{targets.destdir}}/usr/bin/staticcheck"
      install -Dm644 ../../LICENSE "${{targets.destdir}}/usr/share/staticcheck/LICENSE"

subpackages:
  - name: "staticcheck-doc"
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share/doc/staticcheck"
          cp -a "${{targets.destdir}}/usr/share/staticcheck/LICENSE" "${{targets.subpkgdir}}/usr/share/doc/staticcheck/LICENSE"

update:
  enabled: true
  github:
    identifier: dominikh/go-tools
    strip-prefix: v
    use-tag: true
