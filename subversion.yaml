package:
  name: subversion
  version: "1.14.5"
  epoch: 3
  description: Replacement for CVS, another versioning system (svn)
  copyright:
    - license: Apache-2.0 AND BSD-2-Clause AND BSD-3-Clause AND HPND-Markus-Kuhn AND MIT AND Unicode-DFS-2015 AND FSFAP

environment:
  contents:
    packages:
      - apr-util-dev
      - autoconf
      - boost-dev
      - build-base
      - busybox
      - ca-certificates-bundle
      - cyrus-sasl-dev
      - file
      - libapr-dev
      - libmagic-dev
      - libtool
      - lz4-dev
      - serf-dev
      - sqlite-dev
      - utf8proc-dev
      - zlib-dev

pipeline:
  - uses: fetch
    with:
      expected-sha256: e6396e99a08ad5a7d944f285340821ce0acbaa8a40f1c82dc79715ac94c927a8
      uri: https://github.com/apache/subversion/archive/refs/tags/${{package.version}}.tar.gz

  - runs: ./autogen.sh

  - uses: autoconf/configure
    with:
      opts: |
        --with-apr=/usr/bin/apr-1-config \
        --with-apr-util=/usr/bin/apu-1-config

  - uses: autoconf/make

  - uses: autoconf/make-install

  - uses: strip

subpackages:
  - name: subversion-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - subversion-libs
    description: subversion development files
    test:
      pipeline:
        - uses: test/pkgconf
        - uses: test/tw/ldd-check

  - name: subversion-doc
    pipeline:
      - uses: split/manpages
    description: subversion manpages
    test:
      pipeline:
        - uses: test/docs

  - name: subversion-bash-completion
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/share/bash-completion/completions
          install -Dm644 tools/client-side/bash_completion "${{targets.subpkgdir}}"/usr/share/bash-completion/completions/subversion
          for i in svn svnadmin svndumpfilter svnlook svnsync svnversion; do ln -sf subversion "${{targets.subpkgdir}}"/usr/share/bash-completion/completions/$i; done
    description: subversion bash completion rules

  - name: subversion-libs
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}"/usr/lib
          mv "${{targets.destdir}}"/usr/lib/* "${{targets.subpkgdir}}"/usr/lib
    description: subversion libraries

update:
  enabled: true
  release-monitor:
    identifier: 4905

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        svn --version
        svnadmin --version
        svnbench --version
        svndumpfilter --version
        svnfsfs --version
        svnlook --version
        svnmucc --version
        svnrdump --version
        svnserve --version
        svnsync --version
        svnversion --version
        svn --help
        svnadmin --help
        svnbench --help
        svndumpfilter --help
        svnfsfs --help
        svnlook --help
        svnmucc --help
        svnrdump --help
        svnserve --help
        svnsync --help
        svnversion --help
