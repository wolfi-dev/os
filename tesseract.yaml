package:
  name: tesseract
  version: "5.5.1"
  epoch: 0
  description: Tesseract Open Source OCR Engine
  copyright:
    - license: Apache-2.0

environment:
  contents:
    packages:
      - autoconf
      - automake
      - build-base
      - busybox
      - ca-certificates-bundle
      - cairo-dev
      - cmake
      - curl-dev
      - expat-dev
      - fontconfig-config
      - fontconfig-dev
      - fribidi-dev
      - glib-dev
      - harfbuzz-dev
      - icu-dev
      - leptonica-dev
      - libarchive-dev
      - libfontconfig1
      - libjpeg-turbo-dev
      - libxft-dev
      - opencl-dev
      - pango
      - pango-dev
      - pkgconf
      - pkgconf-dev
      - tessdata

data:
  - name: langs
    items:
      afr:
      ara:
      aze:
      bel:
      ben:
      bul:
      cat:
      ces:
      chi_sim:
      chi_tra:
      chr:
      dan:
      deu:
      eng:
      enm:
      epo:
      equ:
      est:
      eus:
      fin:
      fra:
      frk:
      frm:
      glg:
      grc:
      heb:
      hin:
      hrv:
      hun:
      ind:
      isl:
      ita:
      ita_old:
      jpn:
      kan:
      kat:
      khm:
      kor:
      lav:
      lit:
      mal:
      mkd:
      mlt:
      msa:
      nld:
      nor:
      osd:
      pol:
      por:
      ron:
      rus:
      slk:
      slv:
      spa:
      spa_old:
      sqi:
      srp:
      swa:
      swe:
      tam:
      tel:
      tgl:
      tha:
      tur:
      ukr:
      vie:

vars:
  tessdata-version: 4.1.0

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/tesseract-ocr/tesseract
      tag: ${{package.version}}
      expected-commit: 3b7c70e34dea179549ed3e995872e2e019eb8477

  - runs: |
      # They have some hardcoded include paths
      ln -s /usr/include/pango-1.0 /usr/include/pango

  - uses: patch
    with:
      patches: install-pango_training.patch

  - uses: cmake/configure
    with:
      opts: -DTESSDATA_PREFIX=/usr/share -DUSE_SYSTEM_ICU=on -DBUILD_SHARED_LIBS=ON

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: tesseract-dev
    pipeline:
      - uses: split/dev
    test:
      pipeline:
        - uses: test/pkgconf

  - range: langs
    name: tesseract-${{range.key}}
    pipeline:
      - runs: |
          mkdir -p ${{targets.subpkgdir}}/usr/share/tessdata
          mv /usr/share/tessdata/${{range.key}}.traineddata ${{targets.subpkgdir}}/usr/share/tessdata/

update:
  enabled: true
  github:
    identifier: tesseract-ocr/tesseract

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        ambiguous_words --version
        classifier_tester --version
        cntraining --version
        combine_lang_model --version
        combine_tessdata --version
        dawg2wordlist --version
        lstmeval --version
        lstmtraining --version
        merge_unicharsets --version
        mftraining --version
        set_unicharset_properties --version
        shapeclustering --version
        tesseract --version
        text2image --version
        unicharset_extractor --version
        wordlist2dawg --version
        classifier_tester --help
        cntraining --help
        combine_lang_model --help
        combine_tessdata --help
        lstmeval --help
        lstmtraining --help
        mftraining --help
        set_unicharset_properties --help
        shapeclustering --help
        tesseract --help
        text2image --help
        unicharset_extractor --help
