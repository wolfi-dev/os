package:
  name: uaa
  version: "77.34.0"
  epoch: 0
  description: CloudFoundry UAA (User Account and Authentication) â€“ All modules built
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - bash
      - busybox
      - curl
      - glibc-locale-en
      - openjdk-21-default-jdk
      - tzdata

environment:
  contents:
    packages:
      - busybox
      - ca-certificates-bundle
      - git
      - gradle
      - nodejs
      - openjdk-21-default-jdk
      - yarn
  environment:
    LANG: en_US.UTF-8
    JAVA_HOME: /usr/lib/jvm/default-jvm

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/cloudfoundry/uaa.git
      tag: v${{package.version}}
      expected-commit: 5664863ae9b3e7b35fe6683523004ab14e697500

  - runs: |
      # Build all components and skip tests
      ./gradlew assemble -x test --no-daemon

      # Collect and install all JARs and WARs into /usr/lib/uaa
      mkdir -p ${{targets.destdir}}/usr/lib/uaa

      find . -type f \( -name "*.jar" -o -name "*.war" \) \
        -exec cp {} ${{targets.destdir}}/usr/lib/uaa/ \;

update:
  enabled: true
  github:
    identifier: cloudfoundry/uaa
    strip-prefix: v
