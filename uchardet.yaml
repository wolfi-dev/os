package:
  name: uchardet
  version: 0.0.8
  epoch: 0
  description: Universal charset detection library
  copyright:
    - license: MPL-1.1 OR GPL-2.0-or-later OR LGPL-2.1-or-later

environment:
  contents:
    packages:
      - build-base
      - busybox
      - ca-certificates-bundle
      - cmake
      - samurai
      - wolfi-base

pipeline:
  - uses: git-checkout
    with:
      repository: https://gitlab.freedesktop.org/uchardet/uchardet.git
      tag: v${{package.version}}
      expected-commit: ae6302a016088ad07177f86d417b20010053632b

  - runs: |
      # Fix CMake version requirement for compatibility with CMake 4.x
      cat CMakeLists.txt | head -5
      sed -i 's/cmake_minimum_required(VERSION 3\.1)/cmake_minimum_required(VERSION 3.5)/' CMakeLists.txt
      echo "After sed:"
      cat CMakeLists.txt | head -5

  - uses: cmake/configure

  - uses: cmake/build

  - uses: cmake/install

  - uses: strip

subpackages:
  - name: uchardet-dev
    pipeline:
      - uses: split/dev
    dependencies:
      runtime:
        - uchardet
    description: uchardet development files
    test:
      pipeline:
        - uses: test/pkgconf

update:
  enabled: true
  release-monitor:
    identifier: 9265

test:
  pipeline:
    - uses: test/tw/ldd-check
    - name: Test uchardet binary
      runs: |
        uchardet --version
    - uses: test/pkgconf
