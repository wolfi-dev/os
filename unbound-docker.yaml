package:
  name: unbound-docker
  version: 0.0.0_git20250424
  epoch: 0
  description: Docker compatbility scripts and tooling for Jenkins
  copyright:
    - license: Apache-2.0
  dependencies:
    # https://github.com/obi12341/docker-unbound/blob/master/Dockerfile
    runtime:
      - unbound
      - bash

environment:
  contents:
    packages:
      - busybox
      - openssl
      - unbound
      - wget

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/obi12341/docker-unbound
      expected-commit: f011d7b580c4fdd93969bdbf55f3ceff9481b64e
      # used master branch here since there won't be any 1:1 mapping between the tags in the repo and version of the package
      # the latest release tag is 1.21.0 as of now
      branch: master

  - runs: |
      mkdir -p /usr/local/etc/unbound/
      mkdir -p ${{targets.contextdir}}/usr/local/etc/unbound/
      install -Dm755 assets/unbound.conf ${{targets.contextdir}}/usr/local/etc/unbound/unbound.conf
      mkdir ${{targets.contextdir}}/usr/local/etc/unbound/conf.d
      unbound-anchor -a /usr/local/etc/unbound/root.key || true # similar to this line https://github.com/obi12341/docker-unbound/blob/f011d7b580c4fdd93969bdbf55f3ceff9481b64e/Dockerfile#L47
      install -Dm644 /usr/local/etc/unbound/root.key ${{targets.contextdir}}/usr/local/etc/unbound/root.key
      unbound-control-setup \
         && wget -q ftp://FTP.INTERNIC.NET/domain/named.cache -O /usr/local/etc/unbound/root.hints
      install -Dm644 /usr/local/etc/unbound/root.hints ${{targets.contextdir}}/usr/local/etc/unbound/root.hints
      ls -latr /etc/unbound
      cp -r /etc/unbound/* ${{targets.contextdir}}/usr/local/etc/unbound/
      install -Dm755 start.sh ${{targets.contextdir}}/start.sh

update:
  enabled: true
  git:

  schedule:
    period: weekly
    reason: This project doesn't do 1:1 releases with the unbound releases, so we need to check for updates weekly.

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        stat /start.sh
