package:
  name: wso2is
  version: "7.1.0"
  epoch: 0
  description: WSO2 Identity Server is a powerful, modern identity and access management solution for your on-premises or cloud environment.
  copyright:
    - license: Apache-2.0
  dependencies:
    runtime:
      - bash # some helper scripts use bash
      - busybox # some helper scripts use busybox
      - openjdk-21-jre

environment:
  contents:
    packages:
      - busybox
      - maven
      - openjdk-11-default-jdk
  environment:
    LANG: en_US.UTF-8
    JAVA_HOME: /usr/lib/jvm/java-11-openjdk
    JAVA_TOOL_OPTIONS: "-Djdk.util.zip.disableZip64ExtraFieldValidation=true -Djdk.nio.zipfs.allowDotZipEntry=true"

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/wso2/product-is
      tag: v${{package.version}}
      expected-commit: 0ecc73efbda486e6aed6f8c4171b93ff8a1d9af0

  - name: Build
    runs: |
      mvn clean install -Dmaven.test.skip=true
      ls -latr modules/distribution/target | grep wso2is-${{package.version}}
      mkdir -p ${{targets.contextdir}}/home/wso2carbon/wso2is-${{package.version}}

  - uses: strip

# subpackages:
#   - name: ${{package.name}}-compat
#     pipeline:
#       - runs: |
#           mkdir -p ${{targets.contextdir}}
#           ln -s /usr/share/java/pulsar ${{targets.contextdir}}/pulsar
update:
  enabled: true
  github:
    identifier: wso2/product-is
    strip-prefix: v

test:
  environment:
    environment:
      JAVA_HOME: /usr/lib/jvm/java-21-openjdk
      PATH: /usr/lib/jvm/java-21-openjdk/bin:$PATH
  pipeline:
    - runs: |
        echo "Starting WSO2 Identity Server..."
