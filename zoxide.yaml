package:
  name: zoxide
  version: "0.9.7"
  epoch: 0
  description: "A smarter cd command. Supports all major shells."
  copyright:
    - license: MIT

environment:
  contents:
    packages:
      - bash
      - build-base
      - busybox
      - ca-certificates-bundle
      - cargo-auditable
      - fzf
      - rust
      - wolfi-base

pipeline:
  - uses: git-checkout
    with:
      repository: https://github.com/ajeetdsouza/zoxide
      tag: v${{package.version}}
      expected-commit: d74bce3b7418ed965f5056297db8bb081a29121c

  - runs: |
      cargo auditable build --release
      install -Dm755 target/release/zoxide "${{targets.destdir}}"/usr/bin/zoxide
      cd contrib/completions
      install -Dm644 zoxide.bash "${{targets.destdir}}"/usr/share/bash-completion/completions/zoxide
      install -Dm644 zoxide.fish -t "${{targets.destdir}}"/usr/share/fish/vendor_completions.d/
      install -Dm644 _zoxide -t "${{targets.destdir}}"/usr/share/zsh/site-functions/

  - uses: strip

subpackages:
  - name: zoxide-bash-completion
    description: bash completion for zoxide
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share/bash-completion/completions"
          mv "${{targets.destdir}}/usr/share/bash-completion/completions/zoxide" \
            "${{targets.subpkgdir}}/usr/share/bash-completion/completions/zoxide"
          rm -rf "${{targets.destdir}}/usr/share/bash-completion"

  - name: zoxide-zsh-completion
    description: zsh completion for zoxide
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share/zsh/site-functions"
          mv "${{targets.destdir}}/usr/share/zsh/site-functions/_zoxide" \
            "${{targets.subpkgdir}}/usr/share/zsh/site-functions/_zoxide"
          rm -rf "${{targets.destdir}}/usr/share/zsh"

  - name: zoxide-fish-completion
    description: fish completion for zoxide
    pipeline:
      - runs: |
          mkdir -p "${{targets.subpkgdir}}/usr/share/fish/vendor_completions.d"
          mv "${{targets.destdir}}/usr/share/fish/vendor_completions.d/" \
            "${{targets.subpkgdir}}/usr/share/fish/vendor_completions.d"
          rm -rf "${{targets.destdir}}/usr/share/fish"

update:
  enabled: true
  github:
    identifier: ajeetdsouza/zoxide
    strip-prefix: v
    use-tag: true

test:
  pipeline:
    # AUTOGENERATED
    - runs: |
        zoxide --version
        zoxide --help
